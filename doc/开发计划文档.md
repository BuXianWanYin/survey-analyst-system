# 在线问卷调查与数据分析系统 - 开发计划文档

## 一、开发计划概述

本开发计划将系统开发分为四个阶段，每个阶段包含详细的功能模块开发、前后端实现步骤、数据库设计、接口设计等内容。开发遵循前后端分离架构，严格按照开发规范文档执行。

---

## 第一阶段：基础功能开发（核心流程）

### 1.1 阶段目标

完成系统最基础的核心功能，实现用户注册登录、问卷设计、问卷发布、数据收集的完整流程，确保系统可以正常运行并完成基本的问卷调查功能。

### 1.2 开发内容

#### 1.2.1 数据库设计与创建

**实现步骤：**

1. **创建数据库**
   ```sql
   CREATE DATABASE survey_analyst DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **创建核心数据表**
   - **用户表 (user)**
     ```sql
     CREATE TABLE `user` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
       `username` VARCHAR(50) NOT NULL COMMENT '用户名',
       `email` VARCHAR(100) COMMENT '邮箱',
       `phone` VARCHAR(20) COMMENT '手机号',
       `password` VARCHAR(255) NOT NULL COMMENT '密码（BCrypt加密）',
       `nickname` VARCHAR(50) COMMENT '昵称',
       `avatar` VARCHAR(255) COMMENT '头像URL',
       `role` VARCHAR(20) DEFAULT 'USER' COMMENT '角色：USER, ADMIN',
       `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       `delete_flag` TINYINT DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
       PRIMARY KEY (`id`),
       UNIQUE KEY `uk_username` (`username`),
       UNIQUE KEY `uk_email` (`email`),
       KEY `idx_phone` (`phone`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
     ```

   - **问卷表 (survey)**
     ```sql
     CREATE TABLE `survey` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '问卷ID',
       `user_id` BIGINT NOT NULL COMMENT '创建用户ID',
       `title` VARCHAR(200) NOT NULL COMMENT '问卷标题',
       `description` TEXT COMMENT '问卷描述',
       `status` VARCHAR(20) DEFAULT 'DRAFT' COMMENT '状态：DRAFT-草稿，PUBLISHED-已发布，PAUSED-已暂停，ENDED-已结束',
       `access_type` VARCHAR(20) DEFAULT 'PUBLIC' COMMENT '访问类型：PUBLIC-公开，PASSWORD-密码访问，PRIVATE-私有',
       `password` VARCHAR(100) COMMENT '访问密码',
       `max_responses` INT COMMENT '最大填写数',
       `start_time` DATETIME COMMENT '开始时间',
       `end_time` DATETIME COMMENT '结束时间',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       `delete_flag` TINYINT DEFAULT 0 COMMENT '删除标志',
       PRIMARY KEY (`id`),
       KEY `idx_user_id` (`user_id`),
       KEY `idx_status` (`status`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问卷表';
     ```

   - **题目表 (question)**
     ```sql
     CREATE TABLE `question` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '题目ID',
       `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
       `type` VARCHAR(20) NOT NULL COMMENT '题型：SINGLE_CHOICE, MULTIPLE_CHOICE, TEXT, TEXTAREA, RATING, SORT, MATRIX, FILE, DATE',
       `title` VARCHAR(500) NOT NULL COMMENT '题目标题',
       `description` TEXT COMMENT '题目描述',
       `required` TINYINT DEFAULT 0 COMMENT '是否必填：0-否，1-是',
       `order_num` INT DEFAULT 0 COMMENT '排序号',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       PRIMARY KEY (`id`),
       KEY `idx_survey_id` (`survey_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='题目表';
     ```

   - **选项表 (option)**
     ```sql
     CREATE TABLE `option` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '选项ID',
       `question_id` BIGINT NOT NULL COMMENT '题目ID',
       `content` VARCHAR(500) NOT NULL COMMENT '选项内容',
       `image_url` VARCHAR(255) COMMENT '选项图片URL',
       `order_num` INT DEFAULT 0 COMMENT '排序号',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_question_id` (`question_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='选项表';
     ```

   - **填写记录表 (response)**
     ```sql
     CREATE TABLE `response` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '填写记录ID',
       `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
       `user_id` BIGINT COMMENT '填写用户ID（匿名填写为NULL）',
       `ip_address` VARCHAR(50) COMMENT 'IP地址',
       `device_type` VARCHAR(20) COMMENT '设备类型：PC, MOBILE',
       `start_time` DATETIME COMMENT '开始填写时间',
       `submit_time` DATETIME COMMENT '提交时间',
       `duration` INT COMMENT '填写时长（秒）',
       `status` VARCHAR(20) DEFAULT 'COMPLETED' COMMENT '状态：COMPLETED-已完成，DRAFT-草稿',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_survey_id` (`survey_id`),
       KEY `idx_user_id` (`user_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='填写记录表';
     ```

   - **填写答案表 (answer)**
     ```sql
     CREATE TABLE `answer` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '答案ID',
       `response_id` BIGINT NOT NULL COMMENT '填写记录ID',
       `question_id` BIGINT NOT NULL COMMENT '题目ID',
       `option_id` BIGINT COMMENT '选项ID（选择题）',
       `content` TEXT COMMENT '答案内容（填空题）',
       `file_url` VARCHAR(255) COMMENT '文件URL（文件上传题）',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_response_id` (`response_id`),
       KEY `idx_question_id` (`question_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='填写答案表';
     ```

#### 1.2.2 后端开发

**1. 实体类开发**

**实现步骤：**

- 创建 `User` 实体类
  - 位置：`com.server.surveyanalystserver.entity.User`
  - 字段：id, username, email, phone, password, nickname, avatar, role, status, createTime, updateTime, deleteFlag
  - 注解：@TableName("user"), @TableId(type = IdType.AUTO), @TableLogic

- 创建 `Survey` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Survey`
  - 字段：id, userId, title, description, status, accessType, password, maxResponses, startTime, endTime, createTime, updateTime, deleteFlag

- 创建 `Question` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Question`
  - 字段：id, surveyId, type, title, description, required, orderNum, createTime, updateTime

- 创建 `Option` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Option`
  - 字段：id, questionId, content, imageUrl, orderNum, createTime

- 创建 `Response` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Response`
  - 字段：id, surveyId, userId, ipAddress, deviceType, startTime, submitTime, duration, status, createTime

- 创建 `Answer` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Answer`
  - 字段：id, responseId, questionId, optionId, content, fileUrl, createTime

**2. Mapper层开发**

**实现步骤：**

- 创建 `UserMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.user.UserMapper`
  - 继承：`BaseMapper<User>`
  - 方法：基础CRUD由MyBatis Plus提供

- 创建 `SurveyMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.SurveyMapper`
  - 继承：`BaseMapper<Survey>`
  - 自定义方法：`selectSurveyListByUserId(Long userId)` - 根据用户ID查询问卷列表

- 创建 `QuestionMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.QuestionMapper`
  - 继承：`BaseMapper<Question>`
  - 自定义方法：`selectQuestionsBySurveyId(Long surveyId)` - 根据问卷ID查询题目列表

- 创建 `OptionMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.OptionMapper`
  - 继承：`BaseMapper<Option>`
  - 自定义方法：`selectOptionsByQuestionId(Long questionId)` - 根据题目ID查询选项列表

- 创建 `ResponseMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.ResponseMapper`
  - 继承：`BaseMapper<Response>`
  - 自定义方法：`selectResponseCountBySurveyId(Long surveyId)` - 统计问卷填写数量

- 创建 `AnswerMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.AnswerMapper`
  - 继承：`BaseMapper<Answer>`

**3. Service层开发**

**实现步骤：**

- 创建 `UserService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.user.UserService`
  - 实现：`com.server.surveyanalystserver.service.impl.user.UserServiceImpl`
  - 方法：
    - `register(UserRegisterDTO dto)` - 用户注册
    - `login(String username, String password)` - 用户登录（返回JWT Token）
    - `getCurrentUser()` - 获取当前用户信息
    - `updateUserInfo(UserUpdateDTO dto)` - 更新用户信息
    - `changePassword(String oldPassword, String newPassword)` - 修改密码

- 创建 `SurveyService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.SurveyService`
  - 实现：`com.server.surveyanalystserver.service.impl.SurveyServiceImpl`
  - 方法：
    - `createSurvey(SurveyCreateDTO dto)` - 创建问卷
    - `updateSurvey(Long id, SurveyUpdateDTO dto)` - 更新问卷
    - `getSurveyById(Long id)` - 获取问卷详情
    - `getSurveyList(Long userId, Integer pageNum, Integer pageSize)` - 分页查询问卷列表
    - `publishSurvey(Long id, SurveyPublishDTO dto)` - 发布问卷
    - `deleteSurvey(Long id)` - 删除问卷（逻辑删除）

- 创建 `QuestionService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.QuestionService`
  - 实现：`com.server.surveyanalystserver.service.impl.QuestionServiceImpl`
  - 方法：
    - `addQuestion(Long surveyId, QuestionCreateDTO dto)` - 添加题目
    - `updateQuestion(Long id, QuestionUpdateDTO dto)` - 更新题目
    - `deleteQuestion(Long id)` - 删除题目
    - `getQuestionsBySurveyId(Long surveyId)` - 获取问卷的所有题目
    - `updateQuestionOrder(List<QuestionOrderDTO> orders)` - 更新题目排序

- 创建 `OptionService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.OptionService`
  - 实现：`com.server.surveyanalystserver.service.impl.OptionServiceImpl`
  - 方法：
    - `addOption(Long questionId, OptionCreateDTO dto)` - 添加选项
    - `updateOption(Long id, OptionUpdateDTO dto)` - 更新选项
    - `deleteOption(Long id)` - 删除选项
    - `getOptionsByQuestionId(Long questionId)` - 获取题目的所有选项

- 创建 `ResponseService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.ResponseService`
  - 实现：`com.server.surveyanalystserver.service.impl.ResponseServiceImpl`
  - 方法：
    - `submitResponse(Long surveyId, ResponseSubmitDTO dto)` - 提交填写记录
    - `saveDraft(Long surveyId, ResponseDraftDTO dto)` - 保存草稿
    - `getResponseById(Long id)` - 获取填写记录详情
    - `getResponseList(Long surveyId, Integer pageNum, Integer pageSize)` - 分页查询填写记录

**4. Controller层开发**

**实现步骤：**

- 创建 `AuthController`（认证控制器）
  - 位置：`com.server.surveyanalystserver.controller.AuthController`
  - 接口：
    - `POST /api/auth/register` - 用户注册
    - `POST /api/auth/login` - 用户登录
    - `POST /api/auth/logout` - 用户登出

- 创建 `UserController`（用户控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.UserController`
  - 接口：
    - `GET /api/user/current` - 获取当前用户信息
    - `PUT /api/user/info` - 更新用户信息
    - `PUT /api/user/password` - 修改密码

- 创建 `SurveyController`（问卷控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.SurveyController`
  - 接口：
    - `POST /api/survey` - 创建问卷
    - `PUT /api/survey/{id}` - 更新问卷
    - `GET /api/survey/{id}` - 获取问卷详情
    - `GET /api/survey/list` - 分页查询问卷列表
    - `POST /api/survey/{id}/publish` - 发布问卷
    - `DELETE /api/survey/{id}` - 删除问卷

- 创建 `QuestionController`（题目控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.QuestionController`
  - 接口：
    - `POST /api/question` - 添加题目
    - `PUT /api/question/{id}` - 更新题目
    - `DELETE /api/question/{id}` - 删除题目
    - `GET /api/question/survey/{surveyId}` - 获取问卷的所有题目
    - `PUT /api/question/order` - 更新题目排序

- 创建 `OptionController`（选项控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.OptionController`
  - 接口：
    - `POST /api/option` - 添加选项
    - `PUT /api/option/{id}` - 更新选项
    - `DELETE /api/option/{id}` - 删除选项

- 创建 `ResponseController`（填写记录控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.ResponseController`
  - 接口：
    - `POST /api/response` - 提交填写记录
    - `POST /api/response/draft` - 保存草稿
    - `GET /api/response/{id}` - 获取填写记录详情
    - `GET /api/response/list` - 分页查询填写记录

**5. 文件上传功能**

**实现步骤：**

- 创建 `FileController`（文件控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.FileController`
  - 接口：
    - `POST /api/file/upload` - 上传文件（图片、文档等）
    - `GET /api/file/{id}` - 获取文件信息
    - `DELETE /api/file/{id}` - 删除文件

- 创建 `FileService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.FileService`
  - 实现：`com.server.surveyanalystserver.service.impl.FileServiceImpl`
  - 功能：
    - 文件上传到 `upload` 目录
    - 文件信息存储到数据库
    - 文件访问URL生成

#### 1.2.3 前端开发

**1. 基础页面开发**

**实现步骤：**

- **登录页面 (Login.vue)**
  - 位置：`src/views/Login.vue`
  - 功能：
    - 用户名/邮箱登录表单
    - 密码输入框
    - 登录按钮
    - 跳转注册链接
    - 调用 `userApi.login()` 接口
    - 登录成功后保存Token，跳转到首页

- **注册页面 (Register.vue)**
  - 位置：`src/views/Register.vue`
  - 功能：
    - 用户名、邮箱、密码注册表单
    - 密码确认验证
    - 注册按钮
    - 调用 `userApi.register()` 接口
    - 注册成功后跳转到登录页

- **首页 (Home.vue)**
  - 位置：`src/views/Home.vue`
  - 功能：
    - 显示欢迎信息
    - 快速创建问卷按钮
    - 我的问卷入口
    - 数据统计概览（可选）

- **主布局 (MainLayout.vue)**
  - 位置：`src/layouts/MainLayout.vue`
  - 功能：
    - 顶部导航栏（Logo、菜单、用户信息、退出登录）
    - 侧边栏菜单（问卷管理、数据统计等）
    - 内容区域（router-view）

**2. 问卷设计器开发**

**实现步骤：**

- **问卷设计页 (SurveyDesign.vue)**
  - 位置：`src/views/user/SurveyDesign.vue`
  - 功能：
    - 问卷基本信息编辑（标题、描述）
    - 题目列表展示（可拖拽排序）
    - 添加题目按钮（弹出题型选择对话框）
    - 题目编辑组件（根据题型显示不同编辑界面）
    - 选项编辑（选择题）
    - 题目删除、复制功能
    - 保存问卷按钮
    - 发布问卷按钮

- **题目编辑组件 (QuestionEditor.vue)**
  - 位置：`src/views/user/components/QuestionEditor.vue`
  - 功能：
    - 题目标题输入
    - 题目描述输入（富文本编辑器）
    - 必填/非必填开关
    - 选项编辑（选择题）
    - 题型特定设置（如评分题的最大值、最小值）

- **题型选择对话框**
  - 支持的题型：
    - 单选题 (SINGLE_CHOICE)
    - 多选题 (MULTIPLE_CHOICE)
    - 单行文本 (TEXT)
    - 多行文本 (TEXTAREA)
    - 评分题 (RATING)
    - 排序题 (SORT)
    - 矩阵题 (MATRIX)
    - 文件上传 (FILE)
    - 日期时间 (DATE)

**3. 问卷列表页开发**

**实现步骤：**

- **问卷列表页 (SurveyList.vue)**
  - 位置：`src/views/user/SurveyList.vue`
  - 功能：
    - 问卷列表展示（卡片或表格形式）
    - 搜索功能
    - 筛选功能（按状态筛选）
    - 分页功能
    - 操作按钮：编辑、发布、查看、删除
    - 创建问卷按钮

**4. 问卷填写页开发**

**实现步骤：**

- **问卷填写页 (SurveyFill.vue)**
  - 位置：`src/views/user/SurveyFill.vue`
  - 功能：
    - 问卷信息展示（标题、描述）
    - 题目列表展示（根据题型渲染不同组件）
    - 填写表单（单选题、多选题、填空题等）
    - 必填项验证
    - 提交按钮
    - 草稿保存功能
    - 填写进度显示
  - 路由：`/survey/fill/:id`（公开访问，无需登录）

**5. API接口封装**

**实现步骤：**

- 完善 `src/api/user.js` - 用户相关API
- 完善 `src/api/survey.js` - 问卷相关API
- 创建 `src/api/question.js` - 题目相关API
- 创建 `src/api/option.js` - 选项相关API
- 创建 `src/api/response.js` - 填写记录相关API
- 创建 `src/api/file.js` - 文件相关API

**6. 状态管理**

**实现步骤：**

- 完善 `src/stores/user.js` - 用户状态管理
- 创建 `src/stores/survey.js` - 问卷状态管理

#### 1.2.4 管理员后台基础框架

**实现步骤：**

- **管理员登录页**
  - 位置：`src/views/admin/Login.vue`（可选，或复用登录页）
  - 功能：管理员专用登录入口

- **管理员后台布局 (AdminLayout.vue)**
  - 位置：`src/layouts/AdminLayout.vue`
  - 功能：
    - 顶部导航栏
    - 侧边栏菜单（用户管理、问卷管理、数据管理、系统监控）
    - 内容区域

- **管理员后台首页 (Dashboard.vue)**
  - 位置：`src/views/admin/Dashboard.vue`
  - 功能：
    - 系统数据概览（用户数、问卷数、填写数等）
    - 数据统计图表（基础图表）

- **后端管理员接口**
  - 创建 `AdminUserController`
  - 创建 `AdminSurveyController`
  - 权限验证：使用 `@PreAuthorize("hasRole('ADMIN')")`

### 1.3 测试要点

1. **功能测试**
   - 用户注册、登录功能
   - 问卷创建、编辑、删除功能
   - 题目添加、编辑、删除功能
   - 选项添加、编辑、删除功能
   - 问卷发布功能
   - 问卷填写功能
   - 数据提交功能

2. **接口测试**
   - 使用Postman测试所有API接口
   - 验证JWT Token认证
   - 验证权限控制

3. **数据测试**
   - 验证数据正确存储到数据库
   - 验证逻辑删除功能
   - 验证关联查询功能

---

## 第二阶段：核心功能开发（数据统计与分析）

### 2.1 阶段目标

实现数据统计、数据分析、数据可视化等核心功能，提供多维度数据分析和可视化展示能力。

### 2.2 开发内容

#### 2.2.1 数据库扩展

**实现步骤：**

- **创建统计缓存表 (statistics_cache)**
  ```sql
  CREATE TABLE `statistics_cache` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ID',
    `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
    `question_id` BIGINT COMMENT '题目ID（题目统计）',
    `stat_type` VARCHAR(50) NOT NULL COMMENT '统计类型',
    `stat_data` TEXT NOT NULL COMMENT '统计数据（JSON格式）',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_survey_question_type` (`survey_id`, `question_id`, `stat_type`),
    KEY `idx_survey_id` (`survey_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='统计缓存表';
  ```

#### 2.2.2 后端开发

**1. 统计Service开发**

**实现步骤：**

- 创建 `StatisticsService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.StatisticsService`
  - 实现：`com.server.surveyanalystserver.service.impl.StatisticsServiceImpl`
  - 方法：
    - `getSurveyStatistics(Long surveyId)` - 获取问卷统计概览
    - `getQuestionStatistics(Long questionId)` - 获取题目统计
    - `getOptionStatistics(Long questionId)` - 获取选项统计（选择人数、比例）
    - `getResponseTrend(Long surveyId, String timeRange)` - 获取填写趋势统计
    - `getResponseSource(Long surveyId)` - 获取填写来源统计
    - `getDeviceStatistics(Long surveyId)` - 获取设备类型统计
    - `refreshStatistics(Long surveyId)` - 刷新统计数据（清除缓存，重新计算）

**2. 分析Service开发**

**实现步骤：**

- 创建 `AnalysisService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.AnalysisService`
  - 实现：`com.server.surveyanalystserver.service.impl.AnalysisServiceImpl`
  - 方法：
    - `crossAnalysis(Long surveyId, Long questionId1, Long questionId2)` - 交叉分析
    - `trendAnalysis(Long surveyId, Long questionId, String timeRange)` - 趋势分析
    - `profileAnalysis(Long surveyId)` - 样本画像分析
    - `filterAnalysis(Long surveyId, AnalysisFilterDTO filter)` - 条件筛选分析

**3. 数据清洗算法实现**

**实现步骤：**

- 创建 `DataCleaningUtils` 工具类
  - 位置：`com.server.surveyanalystserver.utils.DataCleaningUtils`
  - 方法：
    - `removeDuplicates(List<Response> responses)` - 去除重复数据（根据IP、时间等）
    - `filterAbnormalData(List<Response> responses)` - 过滤异常数据（填写时长过短、过长等）
    - `handleMissingValues(List<Answer> answers)` - 处理缺失值

**4. 多维度统计算法实现**

**实现步骤：**

- 在 `StatisticsServiceImpl` 中实现多维度统计
  - 按性别统计
  - 按年龄统计
  - 按地域统计
  - 组合维度统计

**5. Controller开发**

**实现步骤：**

- 创建 `StatisticsController`
  - 位置：`com.server.surveyanalystserver.controller.user.StatisticsController`
  - 接口：
    - `GET /api/statistics/survey/{surveyId}` - 获取问卷统计概览
    - `GET /api/statistics/question/{questionId}` - 获取题目统计
    - `GET /api/statistics/trend/{surveyId}` - 获取填写趋势
    - `GET /api/statistics/source/{surveyId}` - 获取填写来源
    - `GET /api/statistics/device/{surveyId}` - 获取设备统计
    - `POST /api/statistics/refresh/{surveyId}` - 刷新统计数据

- 创建 `AnalysisController`
  - 位置：`com.server.surveyanalystserver.controller.user.AnalysisController`
  - 接口：
    - `POST /api/analysis/cross` - 交叉分析
    - `POST /api/analysis/trend` - 趋势分析
    - `POST /api/analysis/profile` - 样本画像分析
    - `POST /api/analysis/filter` - 条件筛选分析

#### 2.2.3 前端开发

**1. 统计概览页开发**

**实现步骤：**

- **统计概览页 (StatisticsOverview.vue)**
  - 位置：`src/views/user/StatisticsOverview.vue`
  - 功能：
    - 问卷基本信息展示
    - 实时统计卡片（回收率、有效率、填写数等）
    - 定时刷新（每30秒请求接口获取最新数据）
    - 填写趋势图表（折线图）
    - 填写来源图表（饼图）
    - 设备类型图表（柱状图）
    - 导出统计数据按钮

**2. 统计详情页开发**

**实现步骤：**

- **统计详情页 (StatisticsDetail.vue)**
  - 位置：`src/views/user/StatisticsDetail.vue`
  - 功能：
    - 题目列表展示
    - 每个题目的统计结果展示
    - 选择题：选项分布图表（饼图、柱状图）
    - 填空题：词云图（高频词提取）
    - 评分题：平均分、分布图
    - 排序题：排序结果统计

**3. 数据分析页开发**

**实现步骤：**

- **交叉分析页 (CrossAnalysis.vue)**
  - 位置：`src/views/user/CrossAnalysis.vue`
  - 功能：
    - 题目选择器（选择两个题目进行交叉分析）
    - 交叉表展示
    - 交叉分析图表（热力图、柱状图等）

- **趋势分析页 (TrendAnalysis.vue)**
  - 位置：`src/views/user/TrendAnalysis.vue`
  - 功能：
    - 题目选择器
    - 时间范围选择
    - 趋势图表（折线图）
    - 选项趋势对比

- **样本画像页 (ProfileAnalysis.vue)**
  - 位置：`src/views/user/ProfileAnalysis.vue`
  - 功能：
    - 地域分布图表（地图或柱状图）
    - 年龄分布图表（柱状图）
    - 性别分布图表（饼图）
    - 行为特征分析（填写时间偏好、设备偏好等）

**4. 数据可视化仪表盘开发**

**实现步骤：**

- **数据仪表盘 (VisualizationDashboard.vue)**
  - 位置：`src/views/user/VisualizationDashboard.vue`
  - 功能：
    - 多图表组合展示
    - 图表自定义配置
    - 图表导出功能（PNG、PDF）
    - 响应式布局

**5. ECharts工具封装**

**实现步骤：**

- 完善 `src/utils/echarts.js`
  - 创建柱状图配置方法
  - 创建饼图配置方法
  - 创建折线图配置方法
  - 创建雷达图配置方法
  - 创建词云图配置方法
  - 创建热力图配置方法

**6. API接口封装**

**实现步骤：**

- 创建 `src/api/statistics.js` - 统计相关API
- 创建 `src/api/analysis.js` - 分析相关API

#### 2.2.4 数据导出功能

**实现步骤：**

- **后端Excel导出**
  - 使用EasyExcel实现
  - 创建 `ExportService` 接口及实现
  - 方法：
    - `exportSurveyData(Long surveyId, HttpServletResponse response)` - 导出问卷数据
    - `exportStatistics(Long surveyId, HttpServletResponse response)` - 导出统计数据

- **后端PDF导出**
  - 使用iText实现
  - 方法：
    - `exportAnalysisReport(Long surveyId, HttpServletResponse response)` - 导出分析报告PDF

- **前端导出功能**
  - 在统计页面添加导出按钮
  - 调用后端导出接口
  - 使用 `file-saver` 下载文件

### 2.3 测试要点

1. **统计功能测试**
   - 验证统计数据准确性
   - 验证实时刷新功能
   - 验证缓存机制

2. **分析功能测试**
   - 验证交叉分析准确性
   - 验证趋势分析准确性
   - 验证样本画像准确性

3. **数据清洗测试**
   - 验证重复数据去除
   - 验证异常数据过滤
   - 验证缺失值处理

4. **可视化测试**
   - 验证图表正确渲染
   - 验证图表交互功能
   - 验证图表导出功能

---

## 第三阶段：高级功能开发（逻辑跳转与样式定制）

### 3.1 阶段目标

实现问卷逻辑跳转、样式个性化设置、模板管理、安全管理等高级功能，提升问卷设计的灵活性和用户体验。

### 3.2 开发内容

#### 3.2.1 数据库扩展

**实现步骤：**

- **创建逻辑规则表 (logic_rule)**
  ```sql
  CREATE TABLE `logic_rule` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '规则ID',
    `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
    `source_question_id` BIGINT NOT NULL COMMENT '源题目ID',
    `target_question_id` BIGINT COMMENT '目标题目ID（跳转）',
    `rule_type` VARCHAR(20) NOT NULL COMMENT '规则类型：JUMP-跳转，SHOW-显示，HIDE-隐藏',
    `condition_type` VARCHAR(20) NOT NULL COMMENT '条件类型：EQUALS-等于，CONTAINS-包含，NOT_EQUALS-不等于',
    `condition_value` VARCHAR(500) COMMENT '条件值（选项ID或内容）',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_survey_id` (`survey_id`),
    KEY `idx_source_question_id` (`source_question_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='逻辑规则表';
  ```

- **创建模板表 (template)**
  ```sql
  CREATE TABLE `template` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '模板ID',
    `name` VARCHAR(100) NOT NULL COMMENT '模板名称',
    `category` VARCHAR(50) COMMENT '模板分类',
    `description` TEXT COMMENT '模板描述',
    `preview_image` VARCHAR(255) COMMENT '预览图',
    `template_data` TEXT NOT NULL COMMENT '模板数据（JSON格式，包含问卷结构和题目）',
    `is_system` TINYINT DEFAULT 0 COMMENT '是否系统模板：0-用户模板，1-系统模板',
    `create_user_id` BIGINT COMMENT '创建用户ID',
    `use_count` INT DEFAULT 0 COMMENT '使用次数',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_category` (`category`),
    KEY `idx_create_user_id` (`create_user_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='模板表';
  ```

- **扩展问卷表字段**
  ```sql
  ALTER TABLE `survey` 
  ADD COLUMN `theme` VARCHAR(50) COMMENT '主题模板',
  ADD COLUMN `bg_color` VARCHAR(20) COMMENT '背景色',
  ADD COLUMN `theme_color` VARCHAR(20) COMMENT '主题色',
  ADD COLUMN `text_color` VARCHAR(20) COMMENT '文字颜色',
  ADD COLUMN `font_family` VARCHAR(50) COMMENT '字体',
  ADD COLUMN `logo_url` VARCHAR(255) COMMENT 'Logo URL',
  ADD COLUMN `cover_image_url` VARCHAR(255) COMMENT '封面图片URL';
  ```

#### 3.2.2 后端开发

**1. 逻辑规则Service开发**

**实现步骤：**

- 创建 `LogicRuleService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.LogicRuleService`
  - 实现：`com.server.surveyanalystserver.service.impl.LogicRuleServiceImpl`
  - 方法：
    - `addLogicRule(Long surveyId, LogicRuleCreateDTO dto)` - 添加逻辑规则
    - `updateLogicRule(Long id, LogicRuleUpdateDTO dto)` - 更新逻辑规则
    - `deleteLogicRule(Long id)` - 删除逻辑规则
    - `getLogicRulesBySurveyId(Long surveyId)` - 获取问卷的所有逻辑规则
    - `validateLogic(ResponseSubmitDTO dto)` - 验证填写逻辑（数据收集时调用）

**2. 模板Service开发**

**实现步骤：**

- 创建 `TemplateService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.TemplateService`
  - 实现：`com.server.surveyanalystserver.service.impl.TemplateServiceImpl`
  - 方法：
    - `getSystemTemplates()` - 获取系统模板列表
    - `getUserTemplates(Long userId)` - 获取用户模板列表
    - `getTemplateById(Long id)` - 获取模板详情
    - `createTemplateFromSurvey(Long surveyId, String name, String category)` - 从问卷创建模板
    - `createSurveyFromTemplate(Long templateId)` - 从模板创建问卷
    - `deleteTemplate(Long id)` - 删除模板

**3. 问卷逻辑校验算法实现**

**实现步骤：**

- 在 `LogicRuleServiceImpl` 中实现逻辑校验
  - 条件跳转：根据选项跳转到指定题目
  - 显示/隐藏逻辑：根据选项显示/隐藏题目
  - 分页逻辑控制

**4. Controller开发**

**实现步骤：**

- 创建 `LogicRuleController`
  - 位置：`com.server.surveyanalystserver.controller.user.LogicRuleController`
  - 接口：
    - `POST /api/logic-rule` - 添加逻辑规则
    - `PUT /api/logic-rule/{id}` - 更新逻辑规则
    - `DELETE /api/logic-rule/{id}` - 删除逻辑规则
    - `GET /api/logic-rule/survey/{surveyId}` - 获取问卷的逻辑规则

- 创建 `TemplateController`
  - 位置：`com.server.surveyanalystserver.controller.user.TemplateController`
  - 接口：
    - `GET /api/template/system` - 获取系统模板列表
    - `GET /api/template/user` - 获取用户模板列表
    - `GET /api/template/{id}` - 获取模板详情
    - `POST /api/template/from-survey` - 从问卷创建模板
    - `POST /api/template/{id}/create-survey` - 从模板创建问卷
    - `DELETE /api/template/{id}` - 删除模板

#### 3.2.3 前端开发

**1. 逻辑规则配置页开发**

**实现步骤：**

- **逻辑规则配置组件**
  - 位置：`src/views/user/components/LogicRuleEditor.vue`
  - 功能：
    - 规则列表展示
    - 添加规则按钮
    - 规则配置表单：
      - 源题目选择
      - 规则类型选择（跳转、显示、隐藏）
      - 条件配置（条件类型、条件值）
      - 目标题目选择（跳转规则）
    - 规则删除功能
    - 规则预览功能

- **在问卷设计页集成逻辑规则配置**
  - 在 `SurveyDesign.vue` 中添加"逻辑设置"标签页
  - 集成 `LogicRuleEditor` 组件

**2. 样式个性化设置页开发**

**实现步骤：**

- **样式设置组件**
  - 位置：`src/views/user/components/StyleSettings.vue`
  - 功能：
    - 主题模板选择
    - 颜色方案设置（背景色、主题色、文字颜色）
    - 字体设置
    - Logo上传
    - 封面图片上传
    - 移动端预览

- **在问卷设计页集成样式设置**
  - 在 `SurveyDesign.vue` 中添加"样式设置"标签页
  - 集成 `StyleSettings` 组件

**3. 模板管理页开发**

**实现步骤：**

- **模板列表页 (TemplateList.vue)**
  - 位置：`src/views/user/TemplateList.vue`
  - 功能：
    - 模板分类筛选
    - 模板列表展示（卡片形式，显示预览图）
    - 搜索功能
    - 使用模板按钮（从模板创建问卷）
    - 保存为模板按钮（从问卷创建模板）

**4. 问卷填写页逻辑跳转实现**

**实现步骤：**

- **在问卷填写页实现逻辑跳转**
  - 修改 `SurveyFill.vue`
  - 功能：
    - 根据逻辑规则动态显示/隐藏题目
    - 根据选项跳转到指定题目
    - 逻辑规则验证（提交时）

**5. API接口封装**

**实现步骤：**

- 创建 `src/api/logicRule.js` - 逻辑规则相关API
- 创建 `src/api/template.js` - 模板相关API

#### 3.2.4 安全管理功能

**实现步骤：**

- **访问权限控制**
  - 在 `SurveyService` 中实现访问权限验证
  - 支持：公开访问、密码访问、指定用户访问

- **填写限制**
  - IP限制
  - 每人限填一次
  - 时间限制

- **数据加密**
  - 敏感数据加密存储
  - 数据脱敏处理（导出时）

- **前端权限控制**
  - 在问卷填写页实现密码验证
  - 实现访问权限提示

### 3.3 测试要点

1. **逻辑跳转测试**
   - 验证条件跳转功能
   - 验证显示/隐藏逻辑
   - 验证逻辑规则配置

2. **样式设置测试**
   - 验证样式保存
   - 验证样式应用
   - 验证移动端适配

3. **模板管理测试**
   - 验证模板创建
   - 验证从模板创建问卷
   - 验证模板删除

4. **安全功能测试**
   - 验证访问权限控制
   - 验证填写限制
   - 验证数据加密

---

## 第四阶段：管理员后台完善与系统优化

### 4.1 阶段目标

完善管理员后台功能，实现系统监控、数据管理、系统配置等功能，并进行系统优化和测试。

### 4.2 开发内容

#### 4.2.1 数据库扩展

**实现步骤：**

- **创建操作日志表 (operation_log)**
  ```sql
  CREATE TABLE `operation_log` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    `user_id` BIGINT COMMENT '操作用户ID',
    `operation_type` VARCHAR(50) NOT NULL COMMENT '操作类型',
    `operation_desc` VARCHAR(500) COMMENT '操作描述',
    `request_url` VARCHAR(255) COMMENT '请求URL',
    `request_method` VARCHAR(20) COMMENT '请求方法',
    `request_params` TEXT COMMENT '请求参数',
    `response_result` TEXT COMMENT '响应结果',
    `ip_address` VARCHAR(50) COMMENT 'IP地址',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_operation_type` (`operation_type`),
    KEY `idx_create_time` (`create_time`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
  ```

#### 4.2.2 后端开发

**1. 管理员Service开发**

**实现步骤：**

- 完善 `AdminUserService`
  - 方法：
    - `getUserPage(Integer pageNum, Integer pageSize, UserQueryDTO query)` - 分页查询用户
    - `getUserById(Long id)` - 获取用户详情
    - `updateUserStatus(Long id, Integer status)` - 更新用户状态
    - `deleteUser(Long id)` - 删除用户
    - `getUserStatistics()` - 获取用户统计

- 完善 `AdminSurveyService`
  - 方法：
    - `getSurveyPage(Integer pageNum, Integer pageSize, SurveyQueryDTO query)` - 分页查询问卷
    - `getSurveyById(Long id)` - 获取问卷详情
    - `updateSurveyStatus(Long id, String status)` - 更新问卷状态
    - `deleteSurvey(Long id)` - 删除问卷
    - `getSurveyStatistics()` - 获取问卷统计

- 创建 `AdminDataService`
  - 方法：
    - `exportAllData(Long surveyId, String format)` - 批量导出数据
    - `backupData()` - 数据备份
    - `cleanExpiredData(Integer days)` - 清理过期数据

- 创建 `AdminSystemService`
  - 方法：
    - `getSystemStatistics()` - 获取系统统计
    - `getSystemLogs(Integer pageNum, Integer pageSize)` - 获取系统日志
    - `updateSystemConfig(SystemConfigDTO config)` - 更新系统配置

**2. 操作日志功能**

**实现步骤：**

- 创建 `OperationLogService`
  - 位置：`com.server.surveyanalystserver.service.OperationLogService`
  - 方法：
    - `saveLog(OperationLog log)` - 保存操作日志
    - `getLogPage(Integer pageNum, Integer pageSize, LogQueryDTO query)` - 分页查询日志

- 创建 `OperationLogAspect`（AOP切面）
  - 位置：`com.server.surveyanalystserver.aspect.OperationLogAspect`
  - 功能：自动记录Controller方法的操作日志

**3. Controller开发**

**实现步骤：**

- 完善 `AdminUserController`
  - 接口：
    - `GET /api/admin/user/page` - 分页查询用户
    - `GET /api/admin/user/{id}` - 获取用户详情
    - `PUT /api/admin/user/{id}/status` - 更新用户状态
    - `DELETE /api/admin/user/{id}` - 删除用户
    - `GET /api/admin/user/statistics` - 获取用户统计

- 完善 `AdminSurveyController`
  - 接口：
    - `GET /api/admin/survey/page` - 分页查询问卷
    - `GET /api/admin/survey/{id}` - 获取问卷详情
    - `PUT /api/admin/survey/{id}/status` - 更新问卷状态
    - `DELETE /api/admin/survey/{id}` - 删除问卷
    - `GET /api/admin/survey/statistics` - 获取问卷统计

- 完善 `AdminDataController`
  - 接口：
    - `POST /api/admin/data/export` - 批量导出数据
    - `POST /api/admin/data/backup` - 数据备份
    - `POST /api/admin/data/clean` - 清理过期数据

- 创建 `AdminSystemController`
  - 接口：
    - `GET /api/admin/system/statistics` - 获取系统统计
    - `GET /api/admin/system/logs` - 获取系统日志
    - `PUT /api/admin/system/config` - 更新系统配置

#### 4.2.3 前端开发

**1. 用户管理页开发**

**实现步骤：**

- **用户管理页 (UserManage.vue)**
  - 位置：`src/views/admin/UserManage.vue`
  - 功能：
    - 用户列表展示（表格形式）
    - 搜索功能
    - 筛选功能（按状态、角色筛选）
    - 分页功能
    - 操作按钮：查看、编辑、启用/禁用、删除
    - 批量操作功能

**2. 问卷管理页开发**

**实现步骤：**

- **问卷管理页 (SurveyManage.vue)**
  - 位置：`src/views/admin/SurveyManage.vue`
  - 功能：
    - 问卷列表展示
    - 搜索功能
    - 筛选功能（按状态、创建用户筛选）
    - 分页功能
    - 操作按钮：查看、发布/暂停、删除
    - 批量操作功能

**3. 数据管理页开发**

**实现步骤：**

- **数据管理页 (DataManage.vue)**
  - 位置：`src/views/admin/DataManage.vue`
  - 功能：
    - 填写记录列表展示
    - 搜索功能
    - 筛选功能
    - 分页功能
    - 批量导出功能（Excel、CSV、PDF）
    - 数据备份功能
    - 数据清理功能

**4. 系统监控页开发**

**实现步骤：**

- **系统监控页**
  - 位置：`src/views/admin/SystemMonitor.vue`
  - 功能：
    - 系统数据统计展示
    - 系统运行状态监控
    - 系统日志查看
    - 系统配置管理

**5. API接口封装**

**实现步骤：**

- 完善 `src/api/admin.js` - 管理员相关API

#### 4.2.4 系统优化

**实现步骤：**

1. **性能优化**
   - Redis缓存优化（统计数据缓存）
   - 数据库查询优化（索引优化、SQL优化）
   - 前端代码优化（懒加载、代码分割）

2. **用户体验优化**
   - 加载动画
   - 错误提示优化
   - 操作反馈优化

3. **安全性优化**
   - 接口权限验证完善
   - 数据加密完善
   - XSS防护
   - SQL注入防护

4. **代码质量优化**
   - 代码规范检查
   - 单元测试编写
   - 接口文档完善

### 4.3 测试要点

1. **功能测试**
   - 管理员后台所有功能测试
   - 系统监控功能测试
   - 数据管理功能测试

2. **性能测试**
   - 接口响应时间测试
   - 并发测试
   - 大数据量测试

3. **安全测试**
   - 权限验证测试
   - 数据安全测试
   - 接口安全测试

4. **兼容性测试**
   - 浏览器兼容性测试
   - 移动端兼容性测试

---

## 五、开发时间估算

### 第一阶段：基础功能开发
- **预计时间**：4-6周
- **主要工作**：数据库设计、后端基础功能、前端基础页面、管理员后台框架

### 第二阶段：核心功能开发
- **预计时间**：3-4周
- **主要工作**：数据统计、数据分析、数据可视化、数据导出

### 第三阶段：高级功能开发
- **预计时间**：3-4周
- **主要工作**：逻辑跳转、样式设置、模板管理、安全管理

### 第四阶段：管理员后台完善与系统优化
- **预计时间**：2-3周
- **主要工作**：管理员后台功能完善、系统优化、测试

**总计预计时间**：12-17周（约3-4个月）

---

## 六、开发注意事项

1. **严格按照开发规范执行**
   - 遵循前后端开发规范文档
   - 统一代码风格
   - 统一接口规范

2. **数据库设计**
   - 合理设计表结构
   - 添加必要的索引
   - 考虑数据扩展性

3. **接口设计**
   - RESTful API设计规范
   - 统一响应格式
   - 完善的接口文档

4. **安全性**
   - JWT Token认证
   - 权限验证
   - 数据加密
   - 防SQL注入、XSS攻击

5. **性能优化**
   - Redis缓存使用
   - 数据库查询优化
   - 前端代码优化

6. **测试**
   - 每个阶段完成后进行功能测试
   - 接口测试
   - 性能测试
   - 安全测试

7. **文档**
   - 及时更新接口文档
   - 记录开发过程中的问题和解决方案
   - 完善用户使用文档

---

## 七、总结

本开发计划将系统开发分为四个阶段，每个阶段都有明确的目标和详细的实现步骤。开发过程中应严格按照开发规范执行，注重代码质量和系统性能，确保系统能够稳定运行并满足用户需求。建议按照阶段逐步推进，每个阶段完成后进行充分测试，确保系统质量。

