# 在线问卷调查与数据分析系统 - 开发计划文档

## 一、系统概述

本系统是一个基于Web的在线问卷调查与数据分析系统，旨在解决传统问卷调查中设计繁琐、统计低效、分析浅薄等问题。系统采用B/S架构，前端使用JavaScript、Vue.js等技术构建响应式交互界面，适配PC端与移动端；后端使用Spring Boot框架实现核心业务逻辑开发；数据库使用MySQL存储用户信息、问卷模板、填写数据等结构化数据，搭配ECharts实现数据可视化展示。系统支持问卷全流程数字化管理，包括问卷设计、发布、数据收集、多维度分析和可视化展示等功能，并开发了问卷逻辑校验、数据清洗、多维度统计等核心算法。

## 二、开发计划概述

本开发计划将系统开发分为四个阶段，每个阶段包含详细的功能模块开发、前后端实现步骤、数据库设计、接口设计等内容。开发遵循前后端分离架构，严格按照开发规范文档执行。

### 1.1 TDuck参考说明

**重要说明**：本项目将参考TDuck开源问卷系统的设计思路和功能实现方式，但**不使用TDuck的前后端代码**，所有代码将在现有项目（survey-analyst-web和survey-analyst-server）中自主开发。

**参考内容**：
- TDuck的表单设计器设计思路
- TDuck的题型组件实现方式
- TDuck的数据统计展示方式
- TDuck的数据库表结构设计
- **TDuck的页面UI设计和布局**（重点参考）
  - 项目列表页面布局（我的项目）
  - 模板列表页面布局（共享模板）
  - 回收中心页面布局
  - 整体UI风格和交互方式

**不使用的部分**：
- TDuck的前端Vue2代码（项目使用Vue3）
- TDuck的后端Java代码（项目使用自己的后端架构）
- TDuck的依赖库（如tduck-form-generator）

**开发方式**：
- 参考TDuck的功能和界面设计
- 使用Vue3 + Element Plus自主实现
- 使用Spring Boot + MyBatis Plus自主实现后端
- 保持项目代码的独立性和规范性

---

## 三、技术栈说明

### 3.1 后端技术栈

#### 3.1.1 核心框架
- **Java 1.8** - 开发语言
- **Spring Boot 2.6.13** - 核心框架，简化Spring应用开发
- **Spring MVC** - Web层框架，处理HTTP请求
- **MyBatis Plus 3.5.x** - ORM框架，简化数据库操作
- **Spring Security** - 安全框架，处理认证与授权
- **Spring AOP** - 面向切面编程，处理日志、事务等

#### 3.1.2 数据存储
- **MySQL 8.0+** - 关系型数据库，存储结构化数据
- **Redis 6.0+** - 缓存数据库，用于：
  - 会话存储
  - 数据缓存（问卷模板、统计数据）
  - 分布式锁
  - 限流控制

#### 3.1.3 认证与授权
- **JWT (JSON Web Token)** - 无状态身份认证
- **Spring Security JWT** - JWT集成
- **BCrypt** - 密码加密

#### 3.1.4 数据处理
- **Jackson** - JSON序列化/反序列化
- **EasyExcel** - 高性能Excel处理（数据导入导出）
- **iText / Flying Saucer** - PDF文件生成（数据报告、分析报告导出）

#### 3.1.5 工具类库
- **Lombok** - 简化Java代码
- **Hutool** - Java工具类库
- **Apache Commons** - 通用工具类

#### 3.1.6 接口文档生成
- **Swagger / Knife4j** - API接口文档自动生成工具
  - 自动生成RESTful API文档
  - 支持在线测试接口
  - 提供交互式API文档界面

#### 3.1.7 日志
- **Logback** - 日志框架（Spring Boot默认）
- **SLF4J** - 日志门面

#### 3.1.8 构建工具
- **Maven 3.6+** - 项目构建与依赖管理

#### 3.1.9 文件上传处理
- **Spring Boot Multipart** - 文件上传支持（内置）
- **本地文件系统** - 文件存储在后端项目根目录下的upload文件夹

#### 3.1.10 其他
- **Validation API** - 数据校验
- **Druid** - 数据库连接池

### 3.2 前端技术栈

#### 3.2.1 核心框架
- **JavaScript** - 脚本语言
- **Vue 3.x** - 渐进式JavaScript框架
- **Vite** - 前端构建工具，快速开发

#### 3.2.2 UI组件库
- **Element Plus** - Vue 3 UI组件库
- **@element-plus/icons-vue** - Element Plus图标库

#### 3.2.3 状态管理
- **Pinia** - Vue 3官方推荐的状态管理库（替代Vuex）

#### 3.2.4 路由
- **Vue Router 4.x** - 前端路由管理

#### 3.2.5 HTTP请求
- **Axios** - HTTP客户端，处理API请求
- **axios拦截器** - 请求/响应拦截（token处理、错误处理）

#### 3.2.6 数据可视化
- **ECharts 5.x** - 数据可视化图表库
- **vue-echarts** - ECharts的Vue组件封装

#### 3.2.7 表单处理
- **@vueuse/core** - Vue组合式API工具集

#### 3.2.8 富文本编辑
- **Quill** - 富文本编辑器（问卷说明、题目描述）

#### 3.2.9 拖拽功能
- **vue-draggable-plus** - 拖拽排序（问卷题目排序）

#### 3.2.10 工具库
- **Lodash-es** - JavaScript工具库
- **Day.js** - 日期处理库（轻量级替代Moment.js）
- **qrcode.js** - 二维码生成
- **html2canvas** - HTML转图片（图表导出）
- **jsPDF** - PDF文件生成（前端PDF导出，可选）
- **file-saver** - 文件下载

#### 3.2.11 样式处理
- **Sass / Less** - CSS预处理器
- **PostCSS** - CSS后处理器
- **Autoprefixer** - CSS自动添加浏览器前缀

#### 3.2.12 代码规范
- **ESLint** - JavaScript代码检查
- **Prettier** - 代码格式化

### 3.3 系统架构

#### 3.3.1 整体架构
```
┌─────────────────────────────────────────┐
│        前端层 (Vue3)                     │
│  ┌───────────────────────────────────┐  │
│  │   用户前端界面                     │  │
│  │  - 问卷设计器                      │  │
│  │  - 数据可视化                      │  │
│  │  - 问卷填写界面                    │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │   管理员后台界面（独立页面）        │  │
│  │  - 用户管理                        │  │
│  │  - 问卷管理                        │  │
│  │  - 数据管理                        │  │
│  │  - 系统监控                        │  │
│  └───────────────────────────────────┘  │
└─────────────────┬───────────────────────┘
                  │ HTTP
┌─────────────────▼───────────────────────┐
│         API网关层 (Nginx)                │
│  - 反向代理                              │
│  - 负载均衡                              │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│      后端服务层 (Spring Boot)            │
│  - 业务逻辑处理                          │
│  - 接口服务                              │
│  - 安全认证                              │
│  - 管理员权限验证                        │
└─────┬───────────────┬───────────────────┘
      │               │
┌─────▼─────┐   ┌─────▼─────┐
│  MySQL    │   │   Redis   │
│  数据库    │   │   缓存    │
└───────────┘   └───────────┘
```

#### 3.3.2 技术架构分层

**前端架构**：
- **用户前端**
  - 视图层 - Vue组件、页面（问卷设计、数据可视化等）
  - 状态管理层 - Pinia状态管理
  - 服务层 - API请求封装
  - 工具层 - 工具函数、工具类
  
- **管理员后台（独立页面）**
  - 视图层 - 管理后台专用Vue组件、页面
  - 状态管理层 - Pinia状态管理（独立store）
  - 服务层 - 管理后台API请求封装
  - 权限控制 - 路由守卫、权限验证

**后端架构**：
- **Controller层** - 接口控制器
- **Service层** - 业务逻辑层
- **Mapper层** - 数据访问层（MyBatis Plus）
- **Entity层** - 实体类
- **DTO/VO层** - 数据传输对象/视图对象
- **Config层** - 配置类
- **Utils层** - 工具类

### 3.4 文件存储说明

#### 3.4.1 存储位置
- 所有上传的文件（图片、文档等）存储在**后端项目根目录下的upload文件夹**
- 建议目录结构：
  ```
  survey-analyst-server/
  ├── upload/
  │   ├── images/        # 图片文件
  │   ├── documents/     # 文档文件
  │   └── temp/          # 临时文件
  ```

#### 3.4.2 文件管理
- 文件按日期或用户ID分类存储
- 定期清理临时文件和过期文件
- 文件访问通过后端接口提供，确保安全性

### 3.5 技术选型说明

#### 3.5.1 PDF导出功能
- **后端PDF生成**：使用iText或Flying Saucer生成PDF文件
  - 适用于：数据报告、分析报告、问卷数据导出
  - 优势：格式规范、支持复杂布局、可包含图表
- **前端PDF生成**：使用jsPDF（可选）
  - 适用于：简单PDF导出、图表转PDF
  - 优势：减少服务器压力、响应快速
- **应用场景**：
  - 问卷数据分析报告导出（包含统计图表、数据表格、分析结论）
  - 问卷填写数据批量导出
  - 管理员后台数据报表导出

#### 3.5.2 实时统计实现方式
- **实现方案**：使用定时刷新方式
  - 前端定时（如30秒）请求接口获取最新统计数据
  - 优点：实现简单、无需额外技术栈、降低系统复杂度
  - 适用场景：问卷填写频率不高，定时刷新即可满足需求

---

## 第一阶段：基础功能开发（核心流程）

### 1.1 阶段目标

完成系统最基础的核心功能，实现用户注册登录、问卷设计、问卷发布、数据收集的完整流程，确保系统可以正常运行并完成基本的问卷调查功能。

### 1.2 开发内容

#### 1.2.1 数据库设计与创建

**参考TDuck**：`tduck-platform/doc/tduck-v5.sql` - 数据库表结构设计

**实现步骤：**

1. **创建数据库**
   ```sql
   CREATE DATABASE survey_analyst DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **分析TDuck数据库结构**
   - 查看TDuck的SQL脚本，了解其表结构设计
   - 参考TDuck的表字段设计，结合项目需求设计表结构
   - 注意：不使用TDuck的表名，使用项目自己的表名

3. **创建核心数据表**
   - **用户表 (user)**
     ```sql
     CREATE TABLE `user` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
       `account` VARCHAR(50) NOT NULL COMMENT '账号（用于登录，唯一）',
       `email` VARCHAR(100) NOT NULL COMMENT '邮箱（用于登录，唯一）',
       `username` VARCHAR(50) NOT NULL COMMENT '用户名（昵称，不用于登录，可重复）',
       `phone` VARCHAR(20) COMMENT '手机号',
       `password` VARCHAR(255) NOT NULL COMMENT '密码（BCrypt加密）',
       `avatar` VARCHAR(255) COMMENT '头像URL',
       `role` VARCHAR(20) DEFAULT 'USER' COMMENT '角色：USER, ADMIN',
       `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       `delete_flag` TINYINT DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
       PRIMARY KEY (`id`),
       UNIQUE KEY `uk_account` (`account`),
       UNIQUE KEY `uk_email` (`email`),
       KEY `idx_phone` (`phone`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
     ```
     
     **字段说明**：
     - `account`：用户账号，用于登录，必须唯一
     - `email`：用户邮箱，用于登录，必须唯一
     - `username`：用户昵称/显示名称，不用于登录，可以重复
     - **登录方式**：用户可以使用账号（account）或邮箱（email）进行登录

   - **问卷表 (survey)**
     ```sql
     CREATE TABLE `survey` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '问卷ID',
       `user_id` BIGINT NOT NULL COMMENT '创建用户ID',
       `title` VARCHAR(200) NOT NULL COMMENT '问卷标题',
       `description` TEXT COMMENT '问卷描述',
       `status` VARCHAR(20) DEFAULT 'DRAFT' COMMENT '状态：DRAFT-草稿，PUBLISHED-已发布，PAUSED-已暂停，ENDED-已结束',
       `access_type` VARCHAR(20) DEFAULT 'PUBLIC' COMMENT '访问类型：PUBLIC-公开，PASSWORD-密码访问，PRIVATE-私有',
       `password` VARCHAR(100) COMMENT '访问密码',
       `max_responses` INT COMMENT '最大填写数',
       `start_time` DATETIME COMMENT '开始时间',
       `end_time` DATETIME COMMENT '结束时间',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       `delete_flag` TINYINT DEFAULT 0 COMMENT '删除标志',
       PRIMARY KEY (`id`),
       KEY `idx_user_id` (`user_id`),
       KEY `idx_status` (`status`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问卷表';
     ```

   - **题目表 (question)**
     ```sql
     CREATE TABLE `question` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '题目ID',
       `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
       `type` VARCHAR(20) NOT NULL COMMENT '题型：SINGLE_CHOICE, MULTIPLE_CHOICE, TEXT, TEXTAREA, RATING, SORT, MATRIX, FILE, DATE',
       `title` VARCHAR(500) NOT NULL COMMENT '题目标题',
       `description` TEXT COMMENT '题目描述',
       `required` TINYINT DEFAULT 0 COMMENT '是否必填：0-否，1-是',
       `order_num` INT DEFAULT 0 COMMENT '排序号',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
       PRIMARY KEY (`id`),
       KEY `idx_survey_id` (`survey_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='题目表';
     ```

   - **选项表 (option)**
     ```sql
     CREATE TABLE `option` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '选项ID',
       `question_id` BIGINT NOT NULL COMMENT '题目ID',
       `content` VARCHAR(500) NOT NULL COMMENT '选项内容',
       `image_url` VARCHAR(255) COMMENT '选项图片URL',
       `order_num` INT DEFAULT 0 COMMENT '排序号',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_question_id` (`question_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='选项表';
     ```

   - **填写记录表 (response)**
     ```sql
     CREATE TABLE `response` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '填写记录ID',
       `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
       `user_id` BIGINT COMMENT '填写用户ID（匿名填写为NULL）',
       `ip_address` VARCHAR(50) COMMENT 'IP地址',
       `device_type` VARCHAR(20) COMMENT '设备类型：PC, MOBILE',
       `start_time` DATETIME COMMENT '开始填写时间',
       `submit_time` DATETIME COMMENT '提交时间',
       `duration` INT COMMENT '填写时长（秒）',
       `status` VARCHAR(20) DEFAULT 'COMPLETED' COMMENT '状态：COMPLETED-已完成，DRAFT-草稿',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_survey_id` (`survey_id`),
       KEY `idx_user_id` (`user_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='填写记录表';
     ```

   - **填写答案表 (answer)**
     ```sql
     CREATE TABLE `answer` (
       `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '答案ID',
       `response_id` BIGINT NOT NULL COMMENT '填写记录ID',
       `question_id` BIGINT NOT NULL COMMENT '题目ID',
       `option_id` BIGINT COMMENT '选项ID（选择题）',
       `content` TEXT COMMENT '答案内容（填空题）',
       `file_url` VARCHAR(255) COMMENT '文件URL（文件上传题）',
       `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
       PRIMARY KEY (`id`),
       KEY `idx_response_id` (`response_id`),
       KEY `idx_question_id` (`question_id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='填写答案表';
     ```

#### 1.2.2 后端开发

**1. 实体类开发**

**实现步骤：**

- 创建 `User` 实体类
  - 位置：`com.server.surveyanalystserver.entity.User`
  - 字段：id, username, email, phone, password, nickname, avatar, role, status, createTime, updateTime, deleteFlag
  - 注解：@TableName("user"), @TableId(type = IdType.AUTO), @TableLogic

- 创建 `Survey` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Survey`
  - 字段：id, userId, title, description, status, accessType, password, maxResponses, startTime, endTime, createTime, updateTime, deleteFlag

- 创建 `Question` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Question`
  - 字段：id, surveyId, type, title, description, required, orderNum, createTime, updateTime

- 创建 `Option` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Option`
  - 字段：id, questionId, content, imageUrl, orderNum, createTime

- 创建 `Response` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Response`
  - 字段：id, surveyId, userId, ipAddress, deviceType, startTime, submitTime, duration, status, createTime

- 创建 `Answer` 实体类
  - 位置：`com.server.surveyanalystserver.entity.Answer`
  - 字段：id, responseId, questionId, optionId, content, fileUrl, createTime

**2. Mapper层开发**

**实现步骤：**

- 创建 `UserMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.user.UserMapper`
  - 继承：`BaseMapper<User>`
  - 方法：基础CRUD由MyBatis Plus提供

- 创建 `SurveyMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.SurveyMapper`
  - 继承：`BaseMapper<Survey>`
  - 自定义方法：`selectSurveyListByUserId(Long userId)` - 根据用户ID查询问卷列表

- 创建 `QuestionMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.QuestionMapper`
  - 继承：`BaseMapper<Question>`
  - 自定义方法：`selectQuestionsBySurveyId(Long surveyId)` - 根据问卷ID查询题目列表

- 创建 `OptionMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.OptionMapper`
  - 继承：`BaseMapper<Option>`
  - 自定义方法：`selectOptionsByQuestionId(Long questionId)` - 根据题目ID查询选项列表

- 创建 `ResponseMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.ResponseMapper`
  - 继承：`BaseMapper<Response>`
  - 自定义方法：`selectResponseCountBySurveyId(Long surveyId)` - 统计问卷填写数量

- 创建 `AnswerMapper` 接口
  - 位置：`com.server.surveyanalystserver.mapper.AnswerMapper`
  - 继承：`BaseMapper<Answer>`

**3. Service层开发**

**实现步骤：**

- 创建 `UserService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.user.UserService`
  - 实现：`com.server.surveyanalystserver.service.impl.user.UserServiceImpl`
  - 方法：
    - `register(UserRegisterDTO dto)` - 用户注册
      - 参数：account（账号）、email（邮箱）、username（用户名/昵称）、password（密码）
      - 验证：账号和邮箱必须唯一
      - 用户名（username）可以重复，仅作为显示名称
    - `login(String loginName, String password)` - 用户登录（返回JWT Token）
      - 参数：loginName（账号或邮箱）、password（密码）
      - 逻辑：根据账号或邮箱查询用户，验证密码
      - 返回：JWT Token和用户信息
    - `getCurrentUser()` - 获取当前用户信息
    - `updateUserInfo(UserUpdateDTO dto)` - 更新用户信息
    - `changePassword(String oldPassword, String newPassword)` - 修改密码

- 创建 `SurveyService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.SurveyService`
  - 实现：`com.server.surveyanalystserver.service.impl.SurveyServiceImpl`
  - 方法：
    - `createSurvey(SurveyCreateDTO dto)` - 创建问卷
    - `updateSurvey(Long id, SurveyUpdateDTO dto)` - 更新问卷
    - `getSurveyById(Long id)` - 获取问卷详情
    - `getSurveyList(Long userId, Integer pageNum, Integer pageSize)` - 分页查询问卷列表
    - `publishSurvey(Long id, SurveyPublishDTO dto)` - 发布问卷
    - `deleteSurvey(Long id)` - 删除问卷（逻辑删除）

- 创建 `SurveyPublishService` 接口及实现（问卷发布与推广服务）
  - 位置：`com.server.surveyanalystserver.service.SurveyPublishService`
  - 实现：`com.server.surveyanalystserver.service.impl.SurveyPublishServiceImpl`
  - 方法：
    - `generateSurveyLink(Long surveyId)` - 生成问卷链接
    - `generateQRCode(Long surveyId)` - 生成二维码（Base64或图片URL）
    - `generateEmbedCode(Long surveyId)` - 生成嵌入代码（iframe）
    - `getShareLinks(Long surveyId)` - 获取社交媒体分享链接（微信、微博、QQ等）

- 创建 `QuestionService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.QuestionService`
  - 实现：`com.server.surveyanalystserver.service.impl.QuestionServiceImpl`
  - 方法：
    - `addQuestion(Long surveyId, QuestionCreateDTO dto)` - 添加题目
    - `updateQuestion(Long id, QuestionUpdateDTO dto)` - 更新题目
    - `deleteQuestion(Long id)` - 删除题目
    - `getQuestionsBySurveyId(Long surveyId)` - 获取问卷的所有题目
    - `updateQuestionOrder(List<QuestionOrderDTO> orders)` - 更新题目排序

- 创建 `OptionService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.OptionService`
  - 实现：`com.server.surveyanalystserver.service.impl.OptionServiceImpl`
  - 方法：
    - `addOption(Long questionId, OptionCreateDTO dto)` - 添加选项
    - `updateOption(Long id, OptionUpdateDTO dto)` - 更新选项
    - `deleteOption(Long id)` - 删除选项
    - `getOptionsByQuestionId(Long questionId)` - 获取题目的所有选项

- 创建 `ResponseService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.ResponseService`
  - 实现：`com.server.surveyanalystserver.service.impl.ResponseServiceImpl`
  - 方法：
    - `submitResponse(Long surveyId, ResponseSubmitDTO dto)` - 提交填写记录
    - `saveDraft(Long surveyId, ResponseDraftDTO dto)` - 保存草稿
    - `getResponseById(Long id)` - 获取填写记录详情
    - `getResponseList(Long surveyId, Integer pageNum, Integer pageSize)` - 分页查询填写记录

**4. Controller层开发**

**实现步骤：**

- 创建 `AuthController`（认证控制器）
  - 位置：`com.server.surveyanalystserver.controller.AuthController`
  - 接口：
    - `POST /api/auth/register` - 用户注册
      - 请求参数：`{ account: string, email: string, username: string, password: string }`
      - account：账号（必填，唯一）
      - email：邮箱（必填，唯一）
      - username：用户名/昵称（必填，可重复，仅用于显示）
      - password：密码（必填）
    - `POST /api/auth/login` - 用户登录
      - 请求参数：`{ loginName: string, password: string }`
      - loginName：账号或邮箱（必填）
      - password：密码（必填）
      - 返回：JWT Token和用户信息
    - `POST /api/auth/logout` - 用户登出

- 创建 `UserController`（用户控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.UserController`
  - 接口：
    - `GET /api/user/current` - 获取当前用户信息
    - `PUT /api/user/info` - 更新用户信息
    - `PUT /api/user/password` - 修改密码

- 创建 `SurveyController`（问卷控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.SurveyController`
  - 接口：
    - `POST /api/survey` - 创建问卷
    - `PUT /api/survey/{id}` - 更新问卷
    - `GET /api/survey/{id}` - 获取问卷详情
    - `GET /api/survey/list` - 分页查询问卷列表
    - `POST /api/survey/{id}/publish` - 发布问卷
    - `DELETE /api/survey/{id}` - 删除问卷

- 创建 `SurveyPublishController`（问卷发布与推广控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.SurveyPublishController`
  - 接口：
    - `GET /api/survey/{id}/link` - 获取问卷链接
    - `GET /api/survey/{id}/qrcode` - 获取问卷二维码
    - `GET /api/survey/{id}/embed-code` - 获取嵌入代码
    - `GET /api/survey/{id}/share-links` - 获取社交媒体分享链接

- 创建 `QuestionController`（题目控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.QuestionController`
  - 接口：
    - `POST /api/question` - 添加题目
    - `PUT /api/question/{id}` - 更新题目
    - `DELETE /api/question/{id}` - 删除题目
    - `GET /api/question/survey/{surveyId}` - 获取问卷的所有题目
    - `PUT /api/question/order` - 更新题目排序

- 创建 `OptionController`（选项控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.OptionController`
  - 接口：
    - `POST /api/option` - 添加选项
    - `PUT /api/option/{id}` - 更新选项
    - `DELETE /api/option/{id}` - 删除选项

- 创建 `ResponseController`（填写记录控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.ResponseController`
  - 接口：
    - `POST /api/response` - 提交填写记录
    - `POST /api/response/draft` - 保存草稿
    - `GET /api/response/{id}` - 获取填写记录详情
    - `GET /api/response/list` - 分页查询填写记录

**5. 文件上传功能**

**实现步骤：**

- 创建 `FileController`（文件控制器）
  - 位置：`com.server.surveyanalystserver.controller.user.FileController`
  - 接口：
    - `POST /api/file/upload` - 上传文件（图片、文档等）
    - `GET /api/file/{id}` - 获取文件信息
    - `DELETE /api/file/{id}` - 删除文件

- 创建 `FileService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.FileService`
  - 实现：`com.server.surveyanalystserver.service.impl.FileServiceImpl`
  - 功能：
    - 文件上传到 `upload` 目录
    - 文件信息存储到数据库
    - 文件访问URL生成

#### 1.2.3 前端开发

**1. 基础页面开发**

**实现步骤：**

- **登录页面 (Login.vue)**
  - 位置：`src/views/Login.vue`
  - 功能：
    - 登录方式：账号或邮箱登录（统一输入框）
    - 密码输入框
    - 登录按钮
    - 跳转注册链接
    - 调用 `userApi.login(loginName, password)` 接口
      - loginName可以是账号（account）或邮箱（email）
    - 登录成功后保存Token，跳转到首页
  - UI设计：
    - 输入框提示："请输入账号或邮箱"
    - 支持账号和邮箱两种登录方式

- **注册页面 (Register.vue)**
  - 位置：`src/views/Register.vue`
  - 功能：
    - 账号输入框（account，必填，唯一）
    - 邮箱输入框（email，必填，唯一）
    - 用户名输入框（username，必填，昵称，可重复）
    - 密码输入框（必填）
    - 密码确认输入框（必填，验证一致性）
    - 注册按钮
    - 调用 `userApi.register({ account, email, username, password })` 接口
    - 注册成功后跳转到登录页
  - UI设计：
    - 表单验证：账号和邮箱格式验证、唯一性验证
    - 用户名说明："用户名将作为您的显示名称，可以重复"

- **首页 (Home.vue)**
  - 位置：`src/views/Home.vue`
  - 功能：
    - 显示欢迎信息
    - 快速创建问卷按钮
    - 我的问卷入口
    - 数据统计概览（可选）

- **主布局 (MainLayout.vue)**
  - 位置：`src/layouts/MainLayout.vue`
  - 功能：
    - 顶部导航栏（Logo、菜单、用户信息、退出登录）
    - 侧边栏菜单（问卷管理、数据统计等）
    - 内容区域（router-view）

**2. 问卷设计器开发（参考TDuck实现）**

**参考TDuck**：`tduck-front/src/views/form/editor/` - 表单设计器实现方式

**实现步骤：**

- **问卷设计页 (SurveyDesign.vue)**
  - 位置：`src/views/user/SurveyDesign.vue`
  - 参考TDuck的设计器布局：左侧组件库、中间设计区域、右侧属性配置
  - 功能：
    - 问卷基本信息编辑（标题、描述）
    - 题目列表展示（使用vue-draggable-plus实现拖拽排序）
    - 添加题目按钮（参考TDuck的题型选择方式）
    - 题目编辑组件（根据题型显示不同编辑界面）
    - 选项编辑（选择题，参考TDuck的选项编辑方式）
    - 题目删除、复制功能
    - 保存问卷按钮
    - 发布问卷按钮
  - 技术实现：
    - 使用Vue3 Composition API
    - 使用Element Plus组件
    - 使用vue-draggable-plus实现拖拽

- **题目编辑组件 (QuestionEditor.vue)**
  - 位置：`src/views/user/components/QuestionEditor.vue`
  - 参考TDuck的题目编辑方式
  - 功能：
    - 题目标题输入
    - 题目描述输入（富文本编辑器，参考TDuck使用TinyMCE）
    - 必填/非必填开关
    - 选项编辑（选择题，参考TDuck的选项编辑组件）
    - 题型特定设置（如评分题的最大值、最小值）

- **题型选择对话框**
  - 参考TDuck的题型配置方式
  - 支持的题型（参考TDuck实现的题型）：
    - 单选题 (SINGLE_CHOICE)
    - 多选题 (MULTIPLE_CHOICE)
    - 单行文本 (TEXT)
    - 多行文本 (TEXTAREA)
    - 评分题 (RATING)
    - 排序题 (SORT)
    - 矩阵题 (MATRIX)
    - 文件上传 (FILE)
    - 日期时间 (DATE)

**3. 问卷列表页开发（参考TDuck"我的项目"页面设计）**

**参考TDuck**：`demo.tduckapp.com/home` - 我的项目页面布局和交互设计

**实现步骤：**

- **问卷列表页 (SurveyList.vue)**
  - 位置：`src/views/user/SurveyList.vue`
  - **页面布局**（参考TDuck）：
    - 左侧导航栏：Logo + 导航菜单（我的问卷、共享模板、回收中心）
    - 主内容区域：顶部操作栏 + 项目卡片网格
  - **功能**：
    - **顶部操作栏**：
      - 时间筛选：开始时间 - 结束时间选择器（参考TDuck的时间筛选）
      - 搜索框：项目名称搜索（参考TDuck的搜索框样式）
      - 查询按钮：蓝色按钮，带搜索图标
    - **操作按钮区域**：
      - 创建问卷按钮：大号蓝色按钮，带"+"图标（参考TDuck的"+ 创建表单"按钮）
      - 项目状态筛选：标签页形式（全部、待发布、收集中、已停止）
      - 视图切换：网格视图/列表视图图标切换
    - **项目卡片网格**（参考TDuck的卡片设计）：
      - 白色卡片，灰色边框，悬停效果
      - 卡片顶部：蓝色标签（"问卷"）
      - 卡片内容：标题、状态（黑色圆点+文字）、创建时间
      - 卡片底部：操作链接（编辑表单、数据、删除、统计）
    - 分页功能
    - 空状态显示（参考TDuck的空状态设计）
  - **技术实现**：
    - 使用Vue3 Composition API
    - 使用Element Plus组件（Card、Button、Input、DatePicker等）
    - 使用CSS Grid实现响应式网格布局
    - 参考TDuck的UI样式和交互效果

**4. 问卷填写页开发（参考TDuck实现）**

**参考TDuck**：`tduck-front/src/views/form/write/` - 表单填写页实现方式

**实现步骤：**

- **问卷填写页 (SurveyFill.vue)**
  - 位置：`src/views/user/SurveyFill.vue`
  - 参考TDuck的填写页布局和交互方式
  - 功能：
    - 问卷信息展示（标题、描述）
    - 题目列表展示（根据题型渲染不同组件，参考TDuck的题型渲染方式）
    - 填写表单（单选题、多选题、填空题等，参考TDuck的表单组件）
    - 必填项验证（参考TDuck的验证方式）
    - 提交按钮
    - 草稿保存功能（参考TDuck的草稿保存逻辑）
    - 填写进度显示
    - 密码访问验证（参考TDuck的密码验证方式）
  - 路由：`/survey/fill/:id`（公开访问，无需登录）
  - 技术实现：
    - 使用Vue3 Composition API
    - 使用Element Plus表单组件
    - 参考TDuck的题型渲染逻辑，使用Vue3实现

**5. 问卷发布与推广页开发**

**实现步骤：**

- **问卷发布设置页 (SurveyPublish.vue)**
  - 位置：`src/views/user/SurveyPublish.vue`
  - 功能：
    - 发布设置表单：
      - 问卷标题与描述设置
      - 发布状态管理（草稿、发布、暂停、结束）
      - 访问权限设置（公开、密码访问、指定用户、白名单）
      - 填写限制设置（每人限填一次、IP限制、时间限制）
      - 填写截止时间设置
      - 目标填写数量设置
    - 多渠道发布工具：
      - 问卷链接展示与复制功能
      - 二维码展示与下载功能（使用qrcode.js生成）
      - 嵌入代码展示与复制功能（iframe代码）
      - 社交媒体分享按钮（微信、微博、QQ等）
    - 发布状态切换按钮
  - 技术实现：
    - 使用Vue3 Composition API
    - 使用Element Plus组件（Form、Input、DatePicker、Switch等）
    - 使用qrcode.js生成二维码
    - 使用Clipboard API实现复制功能

**6. API接口封装**

**实现步骤：**

- 完善 `src/api/user.js` - 用户相关API
- 完善 `src/api/survey.js` - 问卷相关API
- 创建 `src/api/question.js` - 题目相关API
- 创建 `src/api/option.js` - 选项相关API
- 创建 `src/api/response.js` - 填写记录相关API
- 创建 `src/api/file.js` - 文件相关API
- 创建 `src/api/surveyPublish.js` - 问卷发布与推广相关API

**6. 状态管理**

**实现步骤：**

- 完善 `src/stores/user.js` - 用户状态管理
- 创建 `src/stores/survey.js` - 问卷状态管理

#### 1.2.4 管理员后台基础框架

**实现步骤：**

- **管理员登录页**
  - 位置：`src/views/admin/Login.vue`（可选，或复用登录页）
  - 功能：管理员专用登录入口

- **管理员后台布局 (AdminLayout.vue)**
  - 位置：`src/layouts/AdminLayout.vue`
  - 功能：
    - 顶部导航栏
    - 侧边栏菜单（用户管理、问卷管理、数据管理、系统监控）
    - 内容区域

- **管理员后台首页 (Dashboard.vue)**
  - 位置：`src/views/admin/Dashboard.vue`
  - 功能：
    - 系统数据概览（用户数、问卷数、填写数等）
    - 数据统计图表（基础图表）

- **后端管理员接口**
  - 创建 `AdminUserController`
  - 创建 `AdminSurveyController`
  - 权限验证：使用 `@PreAuthorize("hasRole('ADMIN')")`

### 1.3 测试要点

1. **功能测试**
   - 用户注册、登录功能
   - 问卷创建、编辑、删除功能
   - 题目添加、编辑、删除功能
   - 选项添加、编辑、删除功能
   - 问卷发布功能
   - 问卷填写功能
   - 数据提交功能

2. **接口测试**
   - 使用Postman测试所有API接口
   - 验证JWT Token认证
   - 验证权限控制

3. **数据测试**
   - 验证数据正确存储到数据库
   - 验证逻辑删除功能
   - 验证关联查询功能

---

## 第二阶段：核心功能开发（数据统计与分析）

### 2.1 阶段目标

实现数据统计、数据分析、数据可视化等核心功能，提供多维度数据分析和可视化展示能力。

### 2.2 开发内容

#### 2.2.1 数据库扩展

**实现步骤：**

- **创建统计缓存表 (statistics_cache)**
  ```sql
  CREATE TABLE `statistics_cache` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ID',
    `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
    `question_id` BIGINT COMMENT '题目ID（题目统计）',
    `stat_type` VARCHAR(50) NOT NULL COMMENT '统计类型',
    `stat_data` TEXT NOT NULL COMMENT '统计数据（JSON格式）',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_survey_question_type` (`survey_id`, `question_id`, `stat_type`),
    KEY `idx_survey_id` (`survey_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='统计缓存表';
  ```

#### 2.2.2 后端开发

**1. 统计Service开发**

**实现步骤：**

- 创建 `StatisticsService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.StatisticsService`
  - 实现：`com.server.surveyanalystserver.service.impl.StatisticsServiceImpl`
  - 方法：
    - `getSurveyStatistics(Long surveyId)` - 获取问卷统计概览
    - `getQuestionStatistics(Long questionId)` - 获取题目统计
    - `getOptionStatistics(Long questionId)` - 获取选项统计（选择人数、比例）
    - `getResponseTrend(Long surveyId, String timeRange)` - 获取填写趋势统计
    - `getResponseSource(Long surveyId)` - 获取填写来源统计
    - `getDeviceStatistics(Long surveyId)` - 获取设备类型统计
    - `refreshStatistics(Long surveyId)` - 刷新统计数据（清除缓存，重新计算）

**2. 分析Service开发**

**实现步骤：**

- 创建 `AnalysisService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.AnalysisService`
  - 实现：`com.server.surveyanalystserver.service.impl.AnalysisServiceImpl`
  - 方法：
    - `crossAnalysis(Long surveyId, Long questionId1, Long questionId2)` - 交叉分析
    - `trendAnalysis(Long surveyId, Long questionId, String timeRange)` - 趋势分析
    - `profileAnalysis(Long surveyId)` - 样本画像分析
    - `filterAnalysis(Long surveyId, AnalysisFilterDTO filter)` - 条件筛选分析

**3. 数据清洗算法实现**

**实现步骤：**

- 创建 `DataCleaningUtils` 工具类
  - 位置：`com.server.surveyanalystserver.utils.DataCleaningUtils`
  - 方法：
    - `removeDuplicates(List<Response> responses)` - 去除重复数据（根据IP、时间等）
    - `filterAbnormalData(List<Response> responses)` - 过滤异常数据（填写时长过短、过长等）
    - `handleMissingValues(List<Answer> answers)` - 处理缺失值

**4. 多维度统计算法实现**

**实现步骤：**

- 在 `StatisticsServiceImpl` 中实现多维度统计
  - 按性别统计
  - 按年龄统计
  - 按地域统计
  - 组合维度统计

**5. Controller开发**

**实现步骤：**

- 创建 `StatisticsController`
  - 位置：`com.server.surveyanalystserver.controller.user.StatisticsController`
  - 接口：
    - `GET /api/statistics/survey/{surveyId}` - 获取问卷统计概览
    - `GET /api/statistics/question/{questionId}` - 获取题目统计
    - `GET /api/statistics/trend/{surveyId}` - 获取填写趋势
    - `GET /api/statistics/source/{surveyId}` - 获取填写来源
    - `GET /api/statistics/device/{surveyId}` - 获取设备统计
    - `POST /api/statistics/refresh/{surveyId}` - 刷新统计数据

- 创建 `AnalysisController`
  - 位置：`com.server.surveyanalystserver.controller.user.AnalysisController`
  - 接口：
    - `POST /api/analysis/cross` - 交叉分析
    - `POST /api/analysis/trend` - 趋势分析
    - `POST /api/analysis/profile` - 样本画像分析
    - `POST /api/analysis/filter` - 条件筛选分析

#### 2.2.3 前端开发

**1. 统计概览页开发（参考TDuck实现）**

**参考TDuck**：`tduck-front/src/views/form/statistics/` - 数据统计页实现方式

**实现步骤：**

- **统计概览页 (StatisticsOverview.vue)**
  - 位置：`src/views/user/StatisticsOverview.vue`
  - 参考TDuck的统计页面布局和图表展示方式
  - 功能：
    - 问卷基本信息展示
    - 实时统计卡片（回收率、有效率、填写数等，参考TDuck的统计维度）
    - 定时刷新（每30秒请求接口获取最新数据）
    - 填写趋势图表（折线图，参考TDuck的图表配置）
    - 填写来源图表（饼图，参考TDuck的来源统计）
    - 设备类型图表（柱状图，参考TDuck的设备统计）
    - 导出统计数据按钮
  - 技术实现：
    - 使用ECharts 5.x（TDuck使用5.4.0，项目使用5.5.0，兼容）
    - 参考TDuck的图表配置方式
    - 使用Vue3 Composition API

**2. 统计详情页开发**

**实现步骤：**

- **统计详情页 (StatisticsDetail.vue)**
  - 位置：`src/views/user/StatisticsDetail.vue`
  - 功能：
    - 题目列表展示
    - 每个题目的统计结果展示
    - 选择题：选项分布图表（饼图、柱状图）
    - 填空题：词云图（高频词提取）
    - 评分题：平均分、分布图
    - 排序题：排序结果统计

**3. 数据分析页开发**

**实现步骤：**

- **交叉分析页 (CrossAnalysis.vue)**
  - 位置：`src/views/user/CrossAnalysis.vue`
  - 功能：
    - 题目选择器（选择两个题目进行交叉分析）
    - 交叉表展示
    - 交叉分析图表（热力图、柱状图等）

- **趋势分析页 (TrendAnalysis.vue)**
  - 位置：`src/views/user/TrendAnalysis.vue`
  - 功能：
    - 题目选择器
    - 时间范围选择
    - 趋势图表（折线图）
    - 选项趋势对比

- **样本画像页 (ProfileAnalysis.vue)**
  - 位置：`src/views/user/ProfileAnalysis.vue`
  - 功能：
    - 地域分布图表（地图或柱状图）
    - 年龄分布图表（柱状图）
    - 性别分布图表（饼图）
    - 行为特征分析（填写时间偏好、设备偏好等）

**4. 数据可视化仪表盘开发**

**实现步骤：**

- **数据仪表盘 (VisualizationDashboard.vue)**
  - 位置：`src/views/user/VisualizationDashboard.vue`
  - 功能：
    - 多图表组合展示
    - 图表自定义配置
    - 图表导出功能（PNG、PDF）
    - 响应式布局

**5. ECharts工具封装**

**实现步骤：**

- 完善 `src/utils/echarts.js`
  - 创建柱状图配置方法
  - 创建饼图配置方法
  - 创建折线图配置方法
  - 创建雷达图配置方法
  - 创建词云图配置方法
  - 创建热力图配置方法

**6. API接口封装**

**实现步骤：**

- 创建 `src/api/statistics.js` - 统计相关API
- 创建 `src/api/analysis.js` - 分析相关API

#### 2.2.4 数据导出功能

**实现步骤：**

- **后端Excel导出**
  - 使用EasyExcel实现
  - 创建 `ExportService` 接口及实现
  - 方法：
    - `exportSurveyData(Long surveyId, HttpServletResponse response)` - 导出问卷数据
    - `exportStatistics(Long surveyId, HttpServletResponse response)` - 导出统计数据

- **后端PDF导出**
  - 使用iText实现
  - 方法：
    - `exportAnalysisReport(Long surveyId, HttpServletResponse response)` - 导出分析报告PDF

- **前端导出功能**
  - 在统计页面添加导出按钮
  - 调用后端导出接口
  - 使用 `file-saver` 下载文件

### 2.3 测试要点

1. **统计功能测试**
   - 验证统计数据准确性
   - 验证实时刷新功能
   - 验证缓存机制

2. **分析功能测试**
   - 验证交叉分析准确性
   - 验证趋势分析准确性
   - 验证样本画像准确性

3. **数据清洗测试**
   - 验证重复数据去除
   - 验证异常数据过滤
   - 验证缺失值处理

4. **可视化测试**
   - 验证图表正确渲染
   - 验证图表交互功能
   - 验证图表导出功能

---

## 第三阶段：高级功能开发（逻辑跳转与样式定制）

### 3.1 阶段目标

实现问卷逻辑跳转、样式个性化设置、模板管理、安全管理等高级功能，提升问卷设计的灵活性和用户体验。

### 3.2 开发内容

#### 3.2.1 数据库扩展

**实现步骤：**

- **创建逻辑规则表 (logic_rule)**
  ```sql
  CREATE TABLE `logic_rule` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '规则ID',
    `survey_id` BIGINT NOT NULL COMMENT '问卷ID',
    `source_question_id` BIGINT NOT NULL COMMENT '源题目ID',
    `target_question_id` BIGINT COMMENT '目标题目ID（跳转）',
    `rule_type` VARCHAR(20) NOT NULL COMMENT '规则类型：JUMP-跳转，SHOW-显示，HIDE-隐藏',
    `condition_type` VARCHAR(20) NOT NULL COMMENT '条件类型：EQUALS-等于，CONTAINS-包含，NOT_EQUALS-不等于',
    `condition_value` VARCHAR(500) COMMENT '条件值（选项ID或内容）',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_survey_id` (`survey_id`),
    KEY `idx_source_question_id` (`source_question_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='逻辑规则表';
  ```

- **创建模板表 (template)**
  ```sql
  CREATE TABLE `template` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '模板ID',
    `name` VARCHAR(100) NOT NULL COMMENT '模板名称',
    `category` VARCHAR(50) COMMENT '模板分类',
    `description` TEXT COMMENT '模板描述',
    `preview_image` VARCHAR(255) COMMENT '预览图',
    `template_data` TEXT NOT NULL COMMENT '模板数据（JSON格式，包含问卷结构和题目）',
    `is_system` TINYINT DEFAULT 0 COMMENT '是否系统模板：0-用户模板，1-系统模板',
    `create_user_id` BIGINT COMMENT '创建用户ID',
    `use_count` INT DEFAULT 0 COMMENT '使用次数',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_category` (`category`),
    KEY `idx_create_user_id` (`create_user_id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='模板表';
  ```

- **扩展问卷表字段**
  ```sql
  ALTER TABLE `survey` 
  ADD COLUMN `theme` VARCHAR(50) COMMENT '主题模板',
  ADD COLUMN `bg_color` VARCHAR(20) COMMENT '背景色',
  ADD COLUMN `theme_color` VARCHAR(20) COMMENT '主题色',
  ADD COLUMN `text_color` VARCHAR(20) COMMENT '文字颜色',
  ADD COLUMN `font_family` VARCHAR(50) COMMENT '字体',
  ADD COLUMN `logo_url` VARCHAR(255) COMMENT 'Logo URL',
  ADD COLUMN `cover_image_url` VARCHAR(255) COMMENT '封面图片URL';
  ```

#### 3.2.2 后端开发

**1. 逻辑规则Service开发**

**实现步骤：**

- 创建 `LogicRuleService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.LogicRuleService`
  - 实现：`com.server.surveyanalystserver.service.impl.LogicRuleServiceImpl`
  - 方法：
    - `addLogicRule(Long surveyId, LogicRuleCreateDTO dto)` - 添加逻辑规则
    - `updateLogicRule(Long id, LogicRuleUpdateDTO dto)` - 更新逻辑规则
    - `deleteLogicRule(Long id)` - 删除逻辑规则
    - `getLogicRulesBySurveyId(Long surveyId)` - 获取问卷的所有逻辑规则
    - `validateLogic(ResponseSubmitDTO dto)` - 验证填写逻辑（数据收集时调用）

**2. 模板Service开发**

**实现步骤：**

- 创建 `TemplateService` 接口及实现
  - 位置：`com.server.surveyanalystserver.service.TemplateService`
  - 实现：`com.server.surveyanalystserver.service.impl.TemplateServiceImpl`
  - 方法：
    - `getSystemTemplates()` - 获取系统模板列表
    - `getUserTemplates(Long userId)` - 获取用户模板列表
    - `getTemplateById(Long id)` - 获取模板详情
    - `createTemplateFromSurvey(Long surveyId, String name, String category)` - 从问卷创建模板
    - `createSurveyFromTemplate(Long templateId)` - 从模板创建问卷
    - `deleteTemplate(Long id)` - 删除模板

**3. 问卷逻辑校验算法实现**

**实现步骤：**

- 在 `LogicRuleServiceImpl` 中实现逻辑校验
  - 条件跳转：根据选项跳转到指定题目
  - 显示/隐藏逻辑：根据选项显示/隐藏题目
  - 分页逻辑控制

**4. Controller开发**

**实现步骤：**

- 创建 `LogicRuleController`
  - 位置：`com.server.surveyanalystserver.controller.user.LogicRuleController`
  - 接口：
    - `POST /api/logic-rule` - 添加逻辑规则
    - `PUT /api/logic-rule/{id}` - 更新逻辑规则
    - `DELETE /api/logic-rule/{id}` - 删除逻辑规则
    - `GET /api/logic-rule/survey/{surveyId}` - 获取问卷的逻辑规则

- 创建 `TemplateController`
  - 位置：`com.server.surveyanalystserver.controller.user.TemplateController`
  - 接口：
    - `GET /api/template/system` - 获取系统模板列表
    - `GET /api/template/user` - 获取用户模板列表
    - `GET /api/template/{id}` - 获取模板详情
    - `POST /api/template/from-survey` - 从问卷创建模板
    - `POST /api/template/{id}/create-survey` - 从模板创建问卷
    - `DELETE /api/template/{id}` - 删除模板

#### 3.2.3 前端开发

**1. 逻辑规则配置页开发（参考TDuck实现）**

**参考TDuck**：`tduck-front/src/views/form/logic/` - 逻辑规则配置实现方式

**实现步骤：**

- **逻辑规则配置组件**
  - 位置：`src/views/user/components/LogicRuleEditor.vue`
  - 参考TDuck的逻辑规则配置界面和交互方式
  - 功能：
    - 规则列表展示（参考TDuck的规则列表展示方式）
    - 添加规则按钮
    - 规则配置表单：
      - 源题目选择（参考TDuck的题目选择方式）
      - 规则类型选择（跳转、显示、隐藏，参考TDuck的规则类型）
      - 条件配置（条件类型、条件值，参考TDuck的条件配置方式）
      - 目标题目选择（跳转规则）
    - 规则删除功能
    - 规则预览功能（参考TDuck的预览方式）
  - 技术实现：
    - 使用Vue3 Composition API
    - 使用Element Plus组件
    - 参考TDuck的逻辑规则数据结构

- **在问卷设计页集成逻辑规则配置**
  - 在 `SurveyDesign.vue` 中添加"逻辑设置"标签页（参考TDuck的标签页布局）
  - 集成 `LogicRuleEditor` 组件

**2. 样式个性化设置页开发（参考TDuck实现）**

**参考TDuck**：`tduck-front/src/views/form/theme/` - 样式主题设置实现方式

**实现步骤：**

- **样式设置组件**
  - 位置：`src/views/user/components/StyleSettings.vue`
  - 参考TDuck的主题设置界面和配置方式
  - 功能：
    - 主题模板选择（参考TDuck的主题模板）
    - 颜色方案设置（背景色、主题色、文字颜色，参考TDuck的颜色配置）
    - 字体设置（参考TDuck的字体设置方式）
    - Logo上传（参考TDuck的Logo上传方式）
    - 封面图片上传（参考TDuck的封面设置）
    - 移动端预览（参考TDuck的预览方式）
  - 技术实现：
    - 使用Vue3 Composition API
    - 使用Element Plus组件
    - 参考TDuck的样式配置数据结构

- **在问卷设计页集成样式设置**
  - 在 `SurveyDesign.vue` 中添加"样式设置"标签页（参考TDuck的标签页布局）
  - 集成 `StyleSettings` 组件

**3. 模板管理页开发（参考TDuck"共享模板"页面设计）**

**参考TDuck**：`demo.tduckapp.com/project/template` - 共享模板页面布局和交互设计

**实现步骤：**

- **模板列表页 (TemplateList.vue)**
  - 位置：`src/views/user/TemplateList.vue`
  - **页面布局**（参考TDuck）：
    - 顶部搜索栏：模板名称搜索 + 查询按钮
    - 分类标签页：全部、默认、分类1等（参考TDuck的标签页设计）
    - 模板网格：6列网格布局（参考TDuck的网格布局）
    - 底部分页：居中显示，显示总条数和页码
  - **功能**：
    - 模板分类筛选（标签页形式）
    - 模板列表展示（卡片形式，参考TDuck的模板卡片设计）：
      - 白色卡片，占位图标（文档图标）
      - 模板名称
      - 操作按钮：查看、删除
    - 搜索功能（参考TDuck的搜索框样式）
    - 使用模板按钮（从模板创建问卷）
    - 保存为模板按钮（从问卷创建模板）
  - **技术实现**：
    - 使用Vue3 Composition API
    - 使用Element Plus组件（Card、Tabs、Input、Pagination等）
    - 使用CSS Grid实现6列网格布局
    - 参考TDuck的UI样式和间距

**4. 问卷填写页逻辑跳转实现**

**实现步骤：**

- **在问卷填写页实现逻辑跳转**
  - 修改 `SurveyFill.vue`
  - 功能：
    - 根据逻辑规则动态显示/隐藏题目
    - 根据选项跳转到指定题目
    - 逻辑规则验证（提交时）

**5. API接口封装**

**实现步骤：**

- 创建 `src/api/logicRule.js` - 逻辑规则相关API
- 创建 `src/api/template.js` - 模板相关API

#### 3.2.4 安全管理功能

**实现步骤：**

- **访问权限控制**
  - 在 `SurveyService` 中实现访问权限验证
  - 支持：公开访问、密码访问、指定用户访问

- **填写限制**
  - IP限制
  - 每人限填一次
  - 时间限制

- **数据加密**
  - 敏感数据加密存储
  - 数据脱敏处理（导出时）

- **前端权限控制**
  - 在问卷填写页实现密码验证
  - 实现访问权限提示

### 3.3 测试要点

1. **逻辑跳转测试**
   - 验证条件跳转功能
   - 验证显示/隐藏逻辑
   - 验证逻辑规则配置

2. **样式设置测试**
   - 验证样式保存
   - 验证样式应用
   - 验证移动端适配

3. **模板管理测试**
   - 验证模板创建
   - 验证从模板创建问卷
   - 验证模板删除

4. **安全功能测试**
   - 验证访问权限控制
   - 验证填写限制
   - 验证数据加密

---

## 第四阶段：管理员后台完善与系统优化

### 4.0 管理员后台设计说明

#### 4.0.1 整体架构设计

**管理员后台特点**：
- **独立页面**：管理员后台为独立的前端页面，与普通用户前端界面分离
- **独立路由**：使用独立的路由前缀 `/admin` 进行访问控制
- **独立布局**：使用 `AdminLayout.vue` 布局组件，与用户前端布局不同
- **权限验证**：通过JWT Token和角色权限验证，确保只有管理员可以访问

#### 4.0.2 页面布局设计

**布局结构**：
```
┌─────────────────────────────────────────┐
│  顶部导航栏（Logo、用户信息、退出）      │
├──────────┬──────────────────────────────┤
│          │                              │
│ 侧边栏   │  主内容区域                   │
│ 菜单     │                              │
│          │  - 数据概览                   │
│ - 数据   │  - 用户管理                   │
│  概览    │  - 问卷管理                   │
│ - 用户   │  - 数据管理                   │
│  管理    │  - 系统监控                   │
│ - 问卷   │                              │
│  管理    │                              │
│ - 数据   │                              │
│  管理    │                              │
│ - 系统   │                              │
│  监控    │                              │
│          │                              │
└──────────┴──────────────────────────────┘
```

#### 4.0.3 管理员登录设计

**登录方式**：
- 管理员使用账号或邮箱登录（与普通用户登录方式相同）
- 登录后根据用户角色（role='ADMIN'）判断是否为管理员
- 管理员登录后跳转到 `/admin/dashboard`
- 普通用户登录后跳转到 `/home`

**登录页面**：
- 位置：`src/views/admin/Login.vue`（可选，或复用 `src/views/Login.vue`）
- 功能：账号/邮箱登录，登录后根据角色跳转

#### 4.0.4 管理员后台页面设计

**1. 数据概览页 (Dashboard.vue)**
- 位置：`src/views/admin/Dashboard.vue`
- 功能：
  - 系统数据统计卡片：
    - 总用户数
    - 总问卷数
    - 总填写数
    - 今日新增用户数
    - 今日新增问卷数
    - 今日填写数
  - 数据趋势图表：
    - 用户注册趋势（折线图）
    - 问卷创建趋势（折线图）
    - 填写数据趋势（折线图）
  - 数据分布图表：
    - 用户角色分布（饼图）
    - 问卷状态分布（饼图）
  - 最近操作日志列表

**2. 用户管理页 (UserManage.vue)**
- 位置：`src/views/admin/UserManage.vue`
- 功能：
  - 用户列表表格：
    - 列：ID、账号、邮箱、用户名、角色、状态、创建时间、操作
  - 搜索功能：按账号、邮箱、用户名搜索
  - 筛选功能：按角色（USER/ADMIN）、状态（启用/禁用）筛选
  - 分页功能
  - 操作按钮：
    - 查看：查看用户详情
    - 编辑：编辑用户信息
    - 启用/禁用：切换用户状态
    - 删除：删除用户（逻辑删除）
  - 批量操作：批量启用、批量禁用、批量删除

**3. 问卷管理页 (SurveyManage.vue)**
- 位置：`src/views/admin/SurveyManage.vue`
- 功能：
  - 问卷列表表格：
    - 列：ID、问卷标题、创建用户、状态、创建时间、填写数、操作
  - 搜索功能：按问卷标题、创建用户搜索
  - 筛选功能：按状态（草稿/已发布/已暂停/已结束）筛选
  - 分页功能
  - 操作按钮：
    - 查看：查看问卷详情
    - 发布/暂停：切换问卷状态
    - 删除：删除问卷（逻辑删除）
  - 批量操作：批量发布、批量暂停、批量删除

**4. 数据管理页 (DataManage.vue)**
- 位置：`src/views/admin/DataManage.vue`
- 功能：
  - 填写记录列表表格：
    - 列：ID、问卷标题、填写用户、IP地址、设备类型、提交时间、操作
  - 搜索功能：按问卷标题、填写用户搜索
  - 筛选功能：按问卷、时间范围筛选
  - 分页功能
  - 操作按钮：
    - 查看：查看填写详情
    - 删除：删除填写记录
  - 批量操作：
    - 批量导出：Excel、CSV、PDF格式
    - 批量删除
  - 数据管理功能：
    - 数据备份：备份所有填写数据
    - 数据清理：清理过期数据（可设置保留天数）

**5. 系统监控页 (SystemMonitor.vue)**
- 位置：`src/views/admin/SystemMonitor.vue`
- 功能：
  - 系统运行状态：
    - 服务器状态
    - 数据库状态
    - Redis状态
  - 系统性能监控：
    - CPU使用率
    - 内存使用率
    - 磁盘使用率
  - 系统日志查看：
    - 操作日志列表
    - 错误日志列表
    - 日志搜索和筛选
  - 系统配置管理：
    - 系统参数配置
    - 邮件服务配置
    - 文件存储配置

#### 4.0.5 权限控制设计

**后端权限控制**：
- 使用 `@PreAuthorize("hasRole('ADMIN')")` 注解
- 所有管理员接口都需要验证管理员角色
- 位置：`com.server.surveyanalystserver.controller.admin.*`

**前端权限控制**：
- 路由守卫：检查用户角色，非管理员跳转到首页
- 位置：`src/router/guard.js`
- 代码示例：
  ```javascript
  if (to.meta.requiresAdmin) {
    const userStore = useUserStore()
    if (!userStore.userInfo || userStore.userInfo.role !== 'ADMIN') {
      ElMessage.warning('您没有权限访问此页面')
      next({ name: 'Home' })
      return
    }
  }
  ```

#### 4.0.6 UI设计规范

**管理员后台UI特点**：
- 专业的管理界面风格
- 深色或浅色主题（可配置）
- 清晰的表格和卡片布局
- 丰富的操作按钮和批量操作功能
- 数据可视化图表展示

**颜色方案**：
- 主色调：蓝色（#409EFF）
- 警告色：橙色（#E6A23C）
- 危险色：红色（#F56C6C）
- 成功色：绿色（#67C23A）

### 4.1 阶段目标

完善管理员后台功能，实现系统监控、数据管理、系统配置等功能，并进行系统优化和测试。

### 4.2 开发内容

#### 4.2.1 数据库扩展

**实现步骤：**

- **创建操作日志表 (operation_log)**
  ```sql
  CREATE TABLE `operation_log` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    `user_id` BIGINT COMMENT '操作用户ID',
    `operation_type` VARCHAR(50) NOT NULL COMMENT '操作类型',
    `operation_desc` VARCHAR(500) COMMENT '操作描述',
    `request_url` VARCHAR(255) COMMENT '请求URL',
    `request_method` VARCHAR(20) COMMENT '请求方法',
    `request_params` TEXT COMMENT '请求参数',
    `response_result` TEXT COMMENT '响应结果',
    `ip_address` VARCHAR(50) COMMENT 'IP地址',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_operation_type` (`operation_type`),
    KEY `idx_create_time` (`create_time`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
  ```

#### 4.2.2 后端开发

**1. 管理员Service开发**

**实现步骤：**

- 完善 `AdminUserService`
  - 方法：
    - `getUserPage(Integer pageNum, Integer pageSize, UserQueryDTO query)` - 分页查询用户
    - `getUserById(Long id)` - 获取用户详情
    - `updateUserStatus(Long id, Integer status)` - 更新用户状态
    - `deleteUser(Long id)` - 删除用户
    - `getUserStatistics()` - 获取用户统计

- 完善 `AdminSurveyService`
  - 方法：
    - `getSurveyPage(Integer pageNum, Integer pageSize, SurveyQueryDTO query)` - 分页查询问卷
    - `getSurveyById(Long id)` - 获取问卷详情
    - `updateSurveyStatus(Long id, String status)` - 更新问卷状态
    - `deleteSurvey(Long id)` - 删除问卷
    - `getSurveyStatistics()` - 获取问卷统计

- 创建 `AdminDataService`
  - 方法：
    - `exportAllData(Long surveyId, String format)` - 批量导出数据
    - `backupData()` - 数据备份
    - `cleanExpiredData(Integer days)` - 清理过期数据

- 创建 `AdminSystemService`
  - 方法：
    - `getSystemStatistics()` - 获取系统统计
    - `getSystemLogs(Integer pageNum, Integer pageSize)` - 获取系统日志
    - `updateSystemConfig(SystemConfigDTO config)` - 更新系统配置

**2. 操作日志功能**

**实现步骤：**

- 创建 `OperationLogService`
  - 位置：`com.server.surveyanalystserver.service.OperationLogService`
  - 方法：
    - `saveLog(OperationLog log)` - 保存操作日志
    - `getLogPage(Integer pageNum, Integer pageSize, LogQueryDTO query)` - 分页查询日志

- 创建 `OperationLogAspect`（AOP切面）
  - 位置：`com.server.surveyanalystserver.aspect.OperationLogAspect`
  - 功能：自动记录Controller方法的操作日志

**3. Controller开发**

**实现步骤：**

- 完善 `AdminUserController`
  - 接口：
    - `GET /api/admin/user/page` - 分页查询用户
    - `GET /api/admin/user/{id}` - 获取用户详情
    - `PUT /api/admin/user/{id}/status` - 更新用户状态
    - `DELETE /api/admin/user/{id}` - 删除用户
    - `GET /api/admin/user/statistics` - 获取用户统计

- 完善 `AdminSurveyController`
  - 接口：
    - `GET /api/admin/survey/page` - 分页查询问卷
    - `GET /api/admin/survey/{id}` - 获取问卷详情
    - `PUT /api/admin/survey/{id}/status` - 更新问卷状态
    - `DELETE /api/admin/survey/{id}` - 删除问卷
    - `GET /api/admin/survey/statistics` - 获取问卷统计

- 完善 `AdminDataController`
  - 接口：
    - `POST /api/admin/data/export` - 批量导出数据
    - `POST /api/admin/data/backup` - 数据备份
    - `POST /api/admin/data/clean` - 清理过期数据

- 创建 `AdminSystemController`
  - 接口：
    - `GET /api/admin/system/statistics` - 获取系统统计
    - `GET /api/admin/system/logs` - 获取系统日志
    - `PUT /api/admin/system/config` - 更新系统配置

#### 4.2.3 前端开发

**1. 用户管理页开发**

**实现步骤：**

- **用户管理页 (UserManage.vue)**
  - 位置：`src/views/admin/UserManage.vue`
  - 功能：
    - 用户列表展示（表格形式）
    - 搜索功能
    - 筛选功能（按状态、角色筛选）
    - 分页功能
    - 操作按钮：查看、编辑、启用/禁用、删除
    - 批量操作功能

**2. 问卷管理页开发**

**实现步骤：**

- **问卷管理页 (SurveyManage.vue)**
  - 位置：`src/views/admin/SurveyManage.vue`
  - 功能：
    - 问卷列表展示
    - 搜索功能
    - 筛选功能（按状态、创建用户筛选）
    - 分页功能
    - 操作按钮：查看、发布/暂停、删除
    - 批量操作功能

**3. 数据管理页开发**

**实现步骤：**

- **数据管理页 (DataManage.vue)**
  - 位置：`src/views/admin/DataManage.vue`
  - 功能：
    - 填写记录列表展示
    - 搜索功能
    - 筛选功能
    - 分页功能
    - 批量导出功能（Excel、CSV、PDF）
    - 数据备份功能
    - 数据清理功能

**4. 系统监控页开发**

**实现步骤：**

- **系统监控页**
  - 位置：`src/views/admin/SystemMonitor.vue`
  - 功能：
    - 系统数据统计展示
    - 系统运行状态监控
    - 系统日志查看
    - 系统配置管理

**5. API接口封装**

**实现步骤：**

- 完善 `src/api/admin.js` - 管理员相关API

#### 4.2.4 系统优化

**实现步骤：**

1. **性能优化**
   - Redis缓存优化（统计数据缓存）
   - 数据库查询优化（索引优化、SQL优化）
   - 前端代码优化（懒加载、代码分割）

2. **用户体验优化**
   - 加载动画
   - 错误提示优化
   - 操作反馈优化

3. **安全性优化**
   - 接口权限验证完善
   - 数据加密完善
   - XSS防护
   - SQL注入防护

4. **代码质量优化**
   - 代码规范检查
   - 单元测试编写
   - 接口文档完善

### 4.3 测试要点

1. **功能测试**
   - 管理员后台所有功能测试
   - 系统监控功能测试
   - 数据管理功能测试

2. **性能测试**
   - 接口响应时间测试
   - 并发测试
   - 大数据量测试

3. **安全测试**
   - 权限验证测试
   - 数据安全测试
   - 接口安全测试

4. **兼容性测试**
   - 浏览器兼容性测试
   - 移动端兼容性测试

---

## 五、开发时间估算

### 第一阶段：基础功能开发
- **预计时间**：4-6周
- **主要工作**：数据库设计、后端基础功能、前端基础页面、管理员后台框架

### 第二阶段：核心功能开发
- **预计时间**：3-4周
- **主要工作**：数据统计、数据分析、数据可视化、数据导出

### 第三阶段：高级功能开发
- **预计时间**：3-4周
- **主要工作**：逻辑跳转、样式设置、模板管理、安全管理

### 第四阶段：管理员后台完善与系统优化
- **预计时间**：2-3周
- **主要工作**：管理员后台功能完善、系统优化、测试

**总计预计时间**：12-17周（约3-4个月）

---

## 六、开发注意事项

1. **严格按照开发规范执行**
   - 遵循前后端开发规范文档
   - 统一代码风格
   - 统一接口规范

2. **数据库设计**
   - 合理设计表结构
   - 添加必要的索引
   - 考虑数据扩展性

3. **接口设计**
   - RESTful API设计规范
   - 统一响应格式
   - 完善的接口文档

4. **安全性**
   - JWT Token认证
   - 权限验证
   - 数据加密
   - 防SQL注入、XSS攻击

5. **性能优化**
   - Redis缓存使用
   - 数据库查询优化
   - 前端代码优化

6. **测试**
   - 每个阶段完成后进行功能测试
   - 接口测试
   - 性能测试
   - 安全测试

7. **文档**
   - 及时更新接口文档
   - 记录开发过程中的问题和解决方案
   - 完善用户使用文档

---

## 七、TDuck参考与Vue2到Vue3迁移技术方案

### 7.0 TDuck页面UI设计参考

#### 7.0.1 整体布局设计

**参考TDuck的整体布局结构**：

1. **左侧导航栏**
   - Logo区域（顶部）
   - 导航菜单项（我的项目、共享模板、回收中心等）
   - 当前选中项高亮显示（蓝色背景）
   - 简洁的图标+文字设计

2. **主内容区域**
   - 顶部：搜索栏、筛选条件、操作按钮
   - 中间：内容展示区域（卡片网格或列表）
   - 底部：分页组件

#### 7.0.2 项目列表页面设计（参考"我的项目"页面）

**页面结构**：
```
┌─────────────────────────────────────────┐
│  左侧导航栏  │  主内容区域                │
│            │                            │
│  TDUCKCE   │  [搜索栏] [筛选] [视图切换] │
│            │                            │
│  我的项目 ✓ │  [+ 创建表单] [项目状态筛选] │
│  共享模板   │                            │
│  回收中心   │  ┌──────┐  ┌──────┐        │
│            │  │卡片1 │  │卡片2 │        │
│            │  └──────┘  └──────┘        │
│            │                            │
└─────────────────────────────────────────┘
```

**实现要点**：

1. **顶部操作栏**
   - 时间筛选：开始时间 - 结束时间选择器
   - 搜索框：项目名称搜索
   - 查询按钮：蓝色按钮，带搜索图标
   - 创建表单按钮：大号蓝色按钮，带"+"图标

2. **项目状态筛选**
   - 标签页形式：全部、待发布、收集中、已停止
   - 当前选中项高亮（蓝色下划线）

3. **视图切换**
   - 网格视图图标（默认选中）
   - 列表视图图标
   - 图标高亮显示当前视图

4. **项目卡片设计**
   - 白色卡片，灰色边框
   - 顶部：蓝色标签（"表单"）
   - 标题：项目名称
   - 状态：黑色圆点 + 状态文字（待发布、收集中等）
   - 创建时间：创建时间: YYYY/MM/DD
   - 底部操作链接：编辑表单、数据、删除、统计
   - 卡片间距和布局：网格布局，响应式设计

**Vue3实现代码示例**：

```vue
<!-- src/views/user/SurveyList.vue -->
<template>
  <div class="survey-list-container">
    <!-- 左侧导航栏 -->
    <div class="sidebar">
      <div class="logo">SURVEY ANALYST</div>
      <el-menu :default-active="activeMenu" class="nav-menu">
        <el-menu-item index="my-surveys">
          <el-icon><Document /></el-icon>
          <span>我的问卷</span>
        </el-menu-item>
        <el-menu-item index="templates">
          <el-icon><Grid /></el-icon>
          <span>共享模板</span>
        </el-menu-item>
        <el-menu-item index="recycle">
          <el-icon><Delete /></el-icon>
          <span>回收中心</span>
        </el-menu-item>
      </el-menu>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
      <!-- 顶部操作栏 -->
      <div class="toolbar">
        <div class="search-section">
          <el-date-picker
            v-model="dateRange"
            type="daterange"
            range-separator="至"
            start-placeholder="选择开始时间"
            end-placeholder="选择结束时间"
            class="date-picker"
          />
          <el-input
            v-model="searchKeyword"
            placeholder="请输入项目名称"
            class="search-input"
            clearable
          />
          <el-button type="primary" :icon="Search" @click="handleSearch">
            查询
          </el-button>
        </div>
      </div>

      <!-- 操作按钮和筛选 -->
      <div class="action-bar">
        <el-button type="primary" :icon="Plus" size="large" @click="handleCreate">
          + 创建问卷
        </el-button>
        <div class="status-filter">
          <span class="filter-label">项目状态：</span>
          <el-radio-group v-model="statusFilter" @change="handleStatusChange">
            <el-radio-button label="all">全部</el-radio-button>
            <el-radio-button label="draft">待发布</el-radio-button>
            <el-radio-button label="published">收集中</el-radio-button>
            <el-radio-button label="stopped">已停止</el-radio-button>
          </el-radio-group>
        </div>
        <div class="view-toggle">
          <el-button
            :type="viewMode === 'grid' ? 'primary' : ''"
            :icon="Grid"
            circle
            @click="viewMode = 'grid'"
          />
          <el-button
            :type="viewMode === 'list' ? 'primary' : ''"
            :icon="List"
            circle
            @click="viewMode = 'list'"
          />
        </div>
      </div>

      <!-- 项目卡片网格 -->
      <div v-if="viewMode === 'grid'" class="survey-grid">
        <el-card
          v-for="survey in surveyList"
          :key="survey.id"
          class="survey-card"
          shadow="hover"
        >
          <template #header>
            <div class="card-header">
              <el-tag type="primary" size="small">问卷</el-tag>
            </div>
          </template>
          <div class="card-body">
            <h3 class="survey-title">{{ survey.title }}</h3>
            <div class="survey-status">
              <span class="status-dot"></span>
              <span>{{ getStatusText(survey.status) }}</span>
            </div>
            <div class="survey-time">
              创建时间: {{ formatDate(survey.createTime) }}
            </div>
          </div>
          <div class="card-footer">
            <el-link type="primary" @click="handleEdit(survey.id)">编辑表单</el-link>
            <el-link type="primary" @click="handleData(survey.id)">数据</el-link>
            <el-link type="danger" @click="handleDelete(survey.id)">删除</el-link>
            <el-link type="primary" @click="handleStatistics(survey.id)">统计</el-link>
          </div>
        </el-card>
      </div>

      <!-- 空状态 -->
      <el-empty v-if="surveyList.length === 0" description="暂无数据" />
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElCard, ElButton, ElInput, ElDatePicker, ElMenu, ElMenuItem, ElTag, ElLink, ElEmpty, ElRadioGroup, ElRadioButton } from 'element-plus'
import { Search, Plus, Grid, List, Document, Delete } from '@element-plus/icons-vue'
import { surveyApi } from '@/api/survey'
import { formatDate } from '@/utils'

const activeMenu = ref('my-surveys')
const dateRange = ref([])
const searchKeyword = ref('')
const statusFilter = ref('all')
const viewMode = ref('grid')
const surveyList = ref([])

const handleSearch = () => {
  // 搜索逻辑
}

const handleCreate = () => {
  // 创建问卷
}

const handleStatusChange = () => {
  // 状态筛选
}

const getStatusText = (status) => {
  const statusMap = {
    DRAFT: '待发布',
    PUBLISHED: '收集中',
    PAUSED: '已停止',
    ENDED: '已结束'
  }
  return statusMap[status] || '未知'
}

onMounted(() => {
  loadSurveyList()
})

const loadSurveyList = async () => {
  // 加载问卷列表
}
</script>

<style scoped>
.survey-list-container {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 200px;
  background: #fff;
  border-right: 1px solid #e4e7ed;
}

.logo {
  padding: 20px;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
}

.nav-menu {
  border: none;
}

.main-content {
  flex: 1;
  padding: 20px;
  background: #f5f7fa;
}

.toolbar {
  margin-bottom: 20px;
}

.search-section {
  display: flex;
  gap: 10px;
  align-items: center;
}

.date-picker {
  width: 300px;
}

.search-input {
  width: 300px;
}

.action-bar {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.status-filter {
  display: flex;
  align-items: center;
  gap: 10px;
}

.filter-label {
  font-size: 14px;
  color: #606266;
}

.view-toggle {
  margin-left: auto;
  display: flex;
  gap: 10px;
}

.survey-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}

.survey-card {
  cursor: pointer;
  transition: all 0.3s;
}

.survey-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.card-header {
  display: flex;
  justify-content: flex-end;
}

.card-body {
  min-height: 150px;
}

.survey-title {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 10px;
  color: #303133;
}

.survey-status {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-bottom: 10px;
  font-size: 14px;
  color: #909399;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #909399;
}

.survey-time {
  font-size: 12px;
  color: #c0c4cc;
}

.card-footer {
  display: flex;
  justify-content: space-around;
  padding-top: 10px;
  border-top: 1px solid #ebeef5;
}
</style>
```

#### 7.0.3 模板列表页面设计（参考"共享模板"页面）

**页面特点**：
- 顶部搜索栏：模板名称搜索
- 分类标签页：全部、默认、分类1等
- 模板网格布局：6列网格，每列显示模板卡片
- 模板卡片：白色背景，占位图标，模板名称，查看/删除操作
- 分页组件：底部居中，显示总条数和页码

**实现要点**：

```vue
<!-- src/views/user/TemplateList.vue -->
<template>
  <div class="template-list-container">
    <!-- 搜索栏 -->
    <div class="search-bar">
      <el-input
        v-model="searchKeyword"
        placeholder="请输入模板名称"
        class="search-input"
        clearable
      />
      <el-button type="primary" :icon="Search" @click="handleSearch">
        查询
      </el-button>
    </div>

    <!-- 分类标签页 -->
    <el-tabs v-model="activeCategory" @tab-change="handleCategoryChange">
      <el-tab-pane label="全部" name="all" />
      <el-tab-pane label="默认" name="default" />
      <el-tab-pane label="分类1" name="category1" />
    </el-tabs>

    <!-- 模板网格 -->
    <div class="template-grid">
      <el-card
        v-for="template in templateList"
        :key="template.id"
        class="template-card"
        shadow="hover"
      >
        <div class="template-icon">
          <el-icon :size="60"><Document /></el-icon>
        </div>
        <div class="template-name">{{ template.name }}</div>
        <div class="template-actions">
          <el-button text :icon="View" @click="handleView(template.id)">
            查看
          </el-button>
          <el-button text :icon="Delete" @click="handleDelete(template.id)">
            删除
          </el-button>
        </div>
      </el-card>
    </div>

    <!-- 分页 -->
    <el-pagination
      v-model:current-page="currentPage"
      v-model:page-size="pageSize"
      :total="total"
      layout="total, prev, pager, next"
      class="pagination"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { ElCard, ElInput, ElButton, ElTabs, ElTabPane, ElPagination, ElIcon } from 'element-plus'
import { Search, View, Delete, Document } from '@element-plus/icons-vue'

const searchKeyword = ref('')
const activeCategory = ref('all')
const templateList = ref([])
const currentPage = ref(1)
const pageSize = ref(18)
const total = ref(0)

const handleSearch = () => {
  // 搜索逻辑
}

const handleCategoryChange = () => {
  // 分类切换
}
</script>

<style scoped>
.template-list-container {
  padding: 20px;
}

.search-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.search-input {
  width: 300px;
}

.template-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.template-card {
  text-align: center;
  cursor: pointer;
}

.template-icon {
  padding: 40px 0;
  color: #c0c4cc;
}

.template-name {
  font-size: 14px;
  margin-bottom: 10px;
  color: #303133;
}

.template-actions {
  display: flex;
  justify-content: center;
  gap: 10px;
}

.pagination {
  display: flex;
  justify-content: center;
  margin-top: 40px;
}
</style>
```

#### 7.0.4 回收中心页面设计（参考空状态）

**空状态设计**：
- 大号图标：倾斜的纸箱图标，灰色
- 提示文字："暂无数据"
- 简洁的布局，居中显示

**实现要点**：

```vue
<!-- src/views/user/RecycleBin.vue -->
<template>
  <div class="recycle-bin-container">
    <el-empty description="暂无数据">
      <template #image>
        <el-icon :size="120" color="#c0c4cc">
          <Box />
        </el-icon>
      </template>
    </el-empty>
  </div>
</template>

<script setup>
import { ElEmpty, ElIcon } from 'element-plus'
import { Box } from '@element-plus/icons-vue'
</script>

<style scoped>
.recycle-bin-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 60vh;
}
</style>
```

#### 7.0.5 UI设计规范

**颜色方案**（参考TDuck）：
- 主色调：蓝色（#409EFF）
- 背景色：白色（#FFFFFF）、浅灰（#F5F7FA）
- 文字色：深灰（#303133）、中灰（#606266）、浅灰（#909399）
- 边框色：浅灰（#E4E7ED）

**间距规范**：
- 页面内边距：20px
- 卡片间距：20px
- 组件间距：10px

**字体规范**：
- 标题：16px，加粗
- 正文：14px
- 辅助文字：12px

**交互效果**：
- 卡片悬停：阴影加深，轻微上移
- 按钮悬停：颜色加深
- 过渡动画：0.3s ease

### 7.1 TDuck功能参考分析

#### 7.1.1 表单设计器参考

**TDuck设计器特点**：
- 使用 `tduck-form-generator` 组件库
- 支持拖拽添加题目
- 支持题目编辑、删除、复制、排序
- 支持多种题型配置

**自主实现方案**：
- 使用 Vue3 + Element Plus 实现
- 使用 `vue-draggable-plus` 实现拖拽功能
- 参考TDuck的题型配置方式，自主实现题型组件
- 保持与项目代码风格一致

#### 7.1.2 题型组件参考

**TDuck支持的题型**（参考实现）：
- 单选题、多选题
- 单行文本、多行文本
- 评分题、排序题
- 矩阵题
- 文件上传题
- 日期时间题

**自主实现方案**：
- 每个题型创建独立的Vue3组件
- 位置：`src/views/user/components/question/`
- 使用Element Plus的表单组件
- 参考TDuck的题型配置数据结构

#### 7.1.3 数据统计参考

**TDuck统计功能**（参考实现）：
- 基础统计（选项分布、填写数等）
- 图表展示（使用ECharts）
- 设备统计、来源统计

**自主实现方案**：
- 使用ECharts 5.x实现图表
- 参考TDuck的统计维度
- 扩展多维度统计功能
- 扩展数据分析功能

### 7.2 Vue2到Vue3迁移技术方案

#### 7.2.1 核心语法迁移

**1. 组件定义方式**

**Vue2写法（TDuck）**：
```javascript
export default {
  name: 'ComponentName',
  components: {
    ChildComponent
  },
  data() {
    return {
      message: 'Hello'
    }
  },
  methods: {
    handleClick() {
      this.message = 'Clicked'
    }
  }
}
```

**Vue3写法（项目）**：
```javascript
<script setup>
import { ref } from 'vue'
import ChildComponent from './ChildComponent.vue'

const message = ref('Hello')

const handleClick = () => {
  message.value = 'Clicked'
}
</script>
```

**2. 响应式数据**

**Vue2**：
```javascript
data() {
  return {
    count: 0,
    user: {
      name: 'John',
      age: 20
    }
  }
}
```

**Vue3**：
```javascript
import { ref, reactive } from 'vue'

const count = ref(0)
const user = reactive({
  name: 'John',
  age: 20
})
```

**3. 计算属性**

**Vue2**：
```javascript
computed: {
  fullName() {
    return this.firstName + ' ' + this.lastName
  }
}
```

**Vue3**：
```javascript
import { computed } from 'vue'

const fullName = computed(() => {
  return firstName.value + ' ' + lastName.value
})
```

**4. 生命周期钩子**

**Vue2**：
```javascript
mounted() {
  // 组件挂载后
},
beforeDestroy() {
  // 组件销毁前
}
```

**Vue3**：
```javascript
import { onMounted, onBeforeUnmount } from 'vue'

onMounted(() => {
  // 组件挂载后
})

onBeforeUnmount(() => {
  // 组件销毁前
})
```

**5. 组件通信**

**Vue2 - Props**：
```javascript
props: {
  title: String,
  count: Number
}
```

**Vue3**：
```javascript
const props = defineProps({
  title: String,
  count: Number
})
```

**Vue2 - Emit**：
```javascript
methods: {
  handleSubmit() {
    this.$emit('submit', data)
  }
}
```

**Vue3**：
```javascript
const emit = defineEmits(['submit'])

const handleSubmit = () => {
  emit('submit', data)
}
```

#### 7.2.2 Element UI到Element Plus迁移

**1. 组件导入方式**

**Element UI（TDuck）**：
```javascript
import { Button, Form, FormItem, Input } from 'element-ui'
```

**Element Plus（项目）**：
```javascript
import { ElButton, ElForm, ElFormItem, ElInput } from 'element-plus'
```

**2. 表单验证**

**Element UI**：
```javascript
this.$refs.form.validate((valid) => {
  if (valid) {
    // 验证通过
  }
})
```

**Element Plus**：
```javascript
const formRef = ref()

formRef.value.validate((valid) => {
  if (valid) {
    // 验证通过
  }
})
```

**3. 消息提示**

**Element UI**：
```javascript
this.$message.success('操作成功')
this.$message.error('操作失败')
```

**Element Plus**：
```javascript
import { ElMessage } from 'element-plus'

ElMessage.success('操作成功')
ElMessage.error('操作失败')
```

**4. 图标使用**

**Element UI**：
```html
<i class="el-icon-edit"></i>
```

**Element Plus**：
```html
<el-icon><Edit /></el-icon>
```
```javascript
import { Edit } from '@element-plus/icons-vue'
```

#### 7.2.3 状态管理迁移（Vuex到Pinia）

**Vue2 + Vuex（TDuck）**：
```javascript
// store/modules/user.js
export default {
  namespaced: true,
  state: {
    userInfo: null
  },
  mutations: {
    SET_USER_INFO(state, userInfo) {
      state.userInfo = userInfo
    }
  },
  actions: {
    setUserInfo({ commit }, userInfo) {
      commit('SET_USER_INFO', userInfo)
    }
  }
}

// 组件中使用
this.$store.dispatch('user/setUserInfo', userInfo)
```

**Vue3 + Pinia（项目）**：
```javascript
// stores/user.js
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: null
  }),
  actions: {
    setUserInfo(userInfo) {
      this.userInfo = userInfo
    }
  }
})

// 组件中使用
import { useUserStore } from '@/stores/user'
const userStore = useUserStore()
userStore.setUserInfo(userInfo)
```

#### 7.2.4 路由迁移

**Vue2 Router（TDuck）**：
```javascript
this.$router.push('/path')
this.$route.params.id
```

**Vue3 Router（项目）**：
```javascript
import { useRouter, useRoute } from 'vue-router'

const router = useRouter()
const route = useRoute()

router.push('/path')
route.params.id
```

#### 7.2.5 拖拽功能迁移

**Vue2 - vuedraggable（TDuck）**：
```html
<draggable v-model="list" @end="onEnd">
  <div v-for="item in list" :key="item.id">{{ item.name }}</div>
</draggable>
```

**Vue3 - vue-draggable-plus（项目）**：
```html
<draggable v-model="list" @end="onEnd">
  <template #item="{ element }">
    <div>{{ element.name }}</div>
  </template>
</draggable>
```

#### 7.2.6 表单设计器迁移示例

**参考TDuck的表单设计器结构，使用Vue3实现**：

```vue
<!-- src/views/user/SurveyDesign.vue -->
<template>
  <div class="survey-design-container">
    <!-- 左侧：组件库 -->
    <div class="component-library">
      <el-card>
        <template #header>题型库</template>
        <div class="question-types">
          <el-button 
            v-for="type in questionTypes" 
            :key="type.value"
            @click="addQuestion(type.value)"
          >
            {{ type.label }}
          </el-button>
        </div>
      </el-card>
    </div>

    <!-- 中间：设计区域 -->
    <div class="design-area">
      <draggable
        v-model="questions"
        item-key="id"
        @end="onQuestionOrderChange"
      >
        <template #item="{ element }">
          <QuestionItem
            :question="element"
            @update="updateQuestion"
            @delete="deleteQuestion"
            @copy="copyQuestion"
          />
        </template>
      </draggable>
    </div>

    <!-- 右侧：属性配置 -->
    <div class="property-panel">
      <el-card>
        <template #header>属性配置</template>
        <QuestionProperty
          v-if="selectedQuestion"
          :question="selectedQuestion"
          @update="updateQuestionProperty"
        />
      </el-card>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { ElCard, ElButton } from 'element-plus'
import draggable from 'vue-draggable-plus'
import QuestionItem from './components/QuestionItem.vue'
import QuestionProperty from './components/QuestionProperty.vue'

const questions = ref([])
const selectedQuestion = ref(null)

const questionTypes = [
  { label: '单选题', value: 'SINGLE_CHOICE' },
  { label: '多选题', value: 'MULTIPLE_CHOICE' },
  { label: '单行文本', value: 'TEXT' },
  { label: '多行文本', value: 'TEXTAREA' },
  { label: '评分题', value: 'RATING' },
  { label: '排序题', value: 'SORT' },
  { label: '矩阵题', value: 'MATRIX' },
  { label: '文件上传', value: 'FILE' },
  { label: '日期时间', value: 'DATE' }
]

const addQuestion = (type) => {
  const newQuestion = {
    id: Date.now(),
    type,
    title: '新题目',
    required: false,
    orderNum: questions.value.length
  }
  questions.value.push(newQuestion)
  selectedQuestion.value = newQuestion
}

const updateQuestion = (question) => {
  const index = questions.value.findIndex(q => q.id === question.id)
  if (index !== -1) {
    questions.value[index] = question
  }
}

const deleteQuestion = (questionId) => {
  const index = questions.value.findIndex(q => q.id === questionId)
  if (index !== -1) {
    questions.value.splice(index, 1)
  }
}

const copyQuestion = (question) => {
  const newQuestion = {
    ...question,
    id: Date.now(),
    orderNum: questions.value.length
  }
  questions.value.push(newQuestion)
}

const onQuestionOrderChange = () => {
  questions.value.forEach((q, index) => {
    q.orderNum = index
  })
}

const updateQuestionProperty = (property) => {
  if (selectedQuestion.value) {
    Object.assign(selectedQuestion.value, property)
  }
}
</script>
```

#### 7.2.7 题型组件迁移示例

**单选题组件（Vue3版本）**：

```vue
<!-- src/views/user/components/question/SingleChoice.vue -->
<template>
  <div class="question-item">
    <div class="question-header">
      <span class="question-title">{{ question.title }}</span>
      <el-tag v-if="question.required" type="danger" size="small">必填</el-tag>
    </div>
    <div v-if="question.description" class="question-description">
      {{ question.description }}
    </div>
    <div class="question-options">
      <el-radio-group v-model="selectedOption">
        <el-radio
          v-for="option in question.options"
          :key="option.id"
          :label="option.id"
        >
          {{ option.content }}
          <el-image
            v-if="option.imageUrl"
            :src="option.imageUrl"
            style="width: 100px; height: 100px; margin-left: 10px;"
          />
        </el-radio>
      </el-radio-group>
    </div>
  </div>
</template>

<script setup>
import { ref, watch } from 'vue'
import { ElRadioGroup, ElRadio, ElTag, ElImage } from 'element-plus'

const props = defineProps({
  question: {
    type: Object,
    required: true
  },
  modelValue: {
    type: [String, Number],
    default: null
  }
})

const emit = defineEmits(['update:modelValue'])

const selectedOption = ref(props.modelValue)

watch(selectedOption, (newVal) => {
  emit('update:modelValue', newVal)
})

watch(() => props.modelValue, (newVal) => {
  selectedOption.value = newVal
})
</script>
```

### 7.3 迁移检查清单

#### 7.3.1 语法迁移检查

- [ ] 所有组件改为 `<script setup>` 语法
- [ ] `data()` 改为 `ref()` 或 `reactive()`
- [ ] `computed` 改为 `computed()` 函数
- [ ] `methods` 改为普通函数
- [ ] 生命周期钩子改为组合式API
- [ ] `this.$refs` 改为 `ref()` 变量
- [ ] `this.$router` 改为 `useRouter()`
- [ ] `this.$route` 改为 `useRoute()`
- [ ] `this.$store` 改为 `useStore()`

#### 7.3.2 Element Plus迁移检查

- [ ] 组件导入改为 `ElXxx` 格式
- [ ] 消息提示改为 `ElMessage`
- [ ] 对话框改为 `ElDialog`
- [ ] 图标改为 `<el-icon>` 组件
- [ ] 表单验证API适配
- [ ] 表格API适配

#### 7.3.3 功能迁移检查

- [ ] 拖拽功能迁移到 `vue-draggable-plus`
- [ ] 状态管理迁移到 Pinia
- [ ] 路由守卫适配Vue3
- [ ] API请求适配（Axios使用方式相同）
- [ ] 工具函数适配

### 7.4 迁移步骤建议

1. **第一步：分析TDuck代码**
   - 理解TDuck的功能实现方式
   - 提取核心逻辑和数据结构
   - 记录需要实现的功能点

2. **第二步：创建Vue3组件框架**
   - 创建组件文件结构
   - 使用Vue3语法创建基础框架
   - 保持功能等价性

3. **第三步：逐个功能迁移**
   - 先迁移简单功能
   - 再迁移复杂功能
   - 每个功能迁移后立即测试

4. **第四步：集成测试**
   - 功能测试
   - 兼容性测试
   - 性能测试

---

## 八、数据库操作说明

### 8.1 MCP数据库连接

**MCP配置信息**：
- **MCP名称**：`mysql-survey_analyst`
- **数据库名称**：`survey_analyst`
- **数据库类型**：MySQL 8.0+

**使用方式**：
- 使用MCP（Model Context Protocol）进行数据库操作
- 通过Cursor的MCP功能连接MySQL数据库
- 详细操作说明请参考：`doc/数据库操作文档.md`

### 8.2 重要字段说明

**用户表字段**：
- `account`：用户账号，用于登录，必须唯一
- `email`：用户邮箱，用于登录，必须唯一
- `username`：用户昵称/显示名称，不用于登录，可以重复
- **登录方式**：用户可以使用账号（account）或邮箱（email）进行登录

---

## 九、系统测试与优化迭代

### 9.1 测试策略

#### 9.1.1 测试目标
构建多场景测试用例，开展功能测试、性能测试、兼容性测试、安全性测试。重点测试问卷设计灵活性、数据统计准确性、分析维度完整性、系统响应速度等指标，邀请不同类型用户试用并收集反馈，针对操作便捷性、分析深度、可视化效果等问题进行优化调整。

#### 9.1.2 测试阶段划分
- **单元测试**：每个功能模块开发完成后进行单元测试
- **集成测试**：各模块接口对接完成后进行集成测试
- **系统测试**：系统整体功能测试
- **用户验收测试**：邀请用户试用并收集反馈

### 9.2 功能测试

#### 9.2.1 用户管理模块测试
- **测试用例**：
  - 用户注册功能（账号、邮箱唯一性验证）
  - 用户登录功能（账号/邮箱登录）
  - 用户信息修改功能
  - 密码修改功能
  - 用户状态管理（启用/禁用）

#### 9.2.2 问卷设计模块测试
- **测试用例**：
  - 问卷创建、编辑、删除功能
  - 题目添加、编辑、删除、排序功能
  - 选项添加、编辑、删除功能
  - 多种题型支持（单选题、多选题、填空题、评分题、排序题、矩阵题、文件上传、日期时间）
  - 题目必填/非必填设置
  - 拖拽排序功能
  - 逻辑跳转规则配置
  - 样式个性化设置

#### 9.2.3 问卷发布与推广模块测试
- **测试用例**：
  - 问卷发布状态管理（草稿、发布、暂停、结束）
  - 访问权限设置（公开、密码访问、指定用户）
  - 填写限制设置（每人限填一次、IP限制、时间限制）
  - 问卷链接生成与复制
  - 二维码生成与下载
  - 嵌入代码生成
  - 社交媒体分享功能

#### 9.2.4 数据收集模块测试
- **测试用例**：
  - 问卷填写界面（PC端、移动端自适应）
  - 数据提交与保存
  - 草稿保存功能
  - 问卷逻辑校验（题目逻辑验证、必填项校验、选项关联性检查）
  - 数据验证（前端验证、后端验证）
  - 防重复提交机制
  - 填写进度显示

#### 9.2.5 数据统计模块测试
- **测试用例**：
  - 实时统计功能（回收率、有效率、填写数）
  - 填写趋势统计
  - 填写来源统计
  - 设备类型统计
  - 选项分布统计（饼图、柱状图数据）
  - 填空题词云分析
  - 评分题平均分统计
  - 多维度统计算法（按性别、年龄、地域统计）
  - 数据清洗算法（去除重复数据、异常数据过滤、缺失值处理）

#### 9.2.6 数据分析模块测试
- **测试用例**：
  - 交叉分析功能（题目间关联分析）
  - 趋势分析功能（时间趋势、选项趋势）
  - 样本画像分析（地域分布、年龄分布、性别分布、行为特征）
  - 条件筛选分析
  - 数据对比分析

#### 9.2.7 数据可视化模块测试
- **测试用例**：
  - 图表类型展示（柱状图、饼图、折线图、雷达图、散点图、词云图）
  - 图表自定义配置
  - 图表交互功能（缩放、筛选）
  - 多图表组合展示（仪表盘）
  - 图表导出功能（PNG、PDF）

#### 9.2.8 安全管理模块测试
- **测试用例**：
  - 访问权限控制（公开、密码、指定用户）
  - 填写限制（IP限制、每人限填一次、时间限制）
  - 数据加密存储
  - 数据脱敏处理（导出时）
  - 匿名填写保护

#### 9.2.9 管理员后台测试
- **测试用例**：
  - 用户管理功能（查看、编辑、启用/禁用、删除）
  - 问卷管理功能（查看、发布/暂停、删除）
  - 数据管理功能（查看、导出、备份、清理）
  - 系统监控功能（运行状态、数据统计、日志查看）
  - 权限验证（管理员权限控制）

### 9.3 性能测试

#### 9.3.1 接口响应时间测试
- **测试指标**：
  - 用户登录接口响应时间 < 500ms
  - 问卷列表查询接口响应时间 < 1s
  - 问卷详情查询接口响应时间 < 500ms
  - 数据统计接口响应时间 < 2s
  - 数据导出接口响应时间 < 5s

#### 9.3.2 并发测试
- **测试场景**：
  - 100并发用户同时登录
  - 500并发用户同时填写问卷
  - 1000并发用户同时查询问卷列表
  - 100并发用户同时进行数据统计

#### 9.3.3 大数据量测试
- **测试场景**：
  - 10万条问卷数据查询性能
  - 100万条填写记录统计性能
  - 大数据量导出性能（10万条记录导出）

#### 9.3.4 前端性能测试
- **测试指标**：
  - 页面首次加载时间 < 3s
  - 页面切换响应时间 < 500ms
  - 图表渲染时间 < 2s
  - 大数据量列表滚动流畅度

### 9.4 兼容性测试

#### 9.4.1 浏览器兼容性测试
- **测试浏览器**：
  - Chrome（最新版本）
  - Firefox（最新版本）
  - Safari（最新版本）
  - Edge（最新版本）
  - 360浏览器
  - QQ浏览器

#### 9.4.2 移动端兼容性测试
- **测试设备**：
  - iOS设备（iPhone、iPad）
  - Android设备（不同品牌、不同版本）
  - 不同屏幕尺寸（手机、平板）

#### 9.4.3 响应式布局测试
- **测试场景**：
  - PC端（1920x1080、1366x768）
  - 平板端（768x1024）
  - 手机端（375x667、414x896）

### 9.5 安全性测试

#### 9.5.1 权限验证测试
- **测试用例**：
  - JWT Token认证测试
  - 管理员权限验证测试
  - 接口权限控制测试
  - 前端路由守卫测试

#### 9.5.2 数据安全测试
- **测试用例**：
  - SQL注入防护测试
  - XSS攻击防护测试
  - CSRF攻击防护测试
  - 敏感数据加密测试
  - 数据脱敏处理测试

#### 9.5.3 接口安全测试
- **测试用例**：
  - 接口参数验证测试
  - 接口限流测试
  - 接口防刷测试
  - 文件上传安全测试

### 9.6 用户体验优化

#### 9.6.1 操作便捷性优化
- **优化内容**：
  - 简化问卷设计流程
  - 优化表单填写体验
  - 改进数据统计查看方式
  - 提升操作反馈及时性

#### 9.6.2 分析深度优化
- **优化内容**：
  - 增强数据分析维度
  - 优化分析算法准确性
  - 提升分析结果可读性
  - 增加分析报告模板

#### 9.6.3 可视化效果优化
- **优化内容**：
  - 优化图表样式和配色
  - 提升图表交互体验
  - 增强数据展示直观性
  - 优化移动端图表显示

#### 9.6.4 系统响应速度优化
- **优化内容**：
  - 数据库查询优化（索引优化、SQL优化）
  - Redis缓存优化（统计数据缓存）
  - 前端代码优化（懒加载、代码分割）
  - 接口响应时间优化

### 9.7 用户反馈收集与处理

#### 9.7.1 反馈收集方式
- **收集渠道**：
  - 系统内置反馈表单
  - 用户访谈
  - 问卷调查
  - 使用数据分析（用户行为分析）

#### 9.7.2 反馈处理流程
1. **反馈收集**：收集用户反馈和建议
2. **问题分析**：分析反馈问题的优先级和影响范围
3. **方案设计**：设计优化方案
4. **开发实施**：实施优化开发
5. **测试验证**：测试验证优化效果
6. **发布上线**：发布优化版本
7. **效果评估**：评估优化效果，收集新的反馈

#### 9.7.3 迭代优化计划
- **第一轮优化**：针对核心功能操作便捷性优化
- **第二轮优化**：针对数据分析深度和可视化效果优化
- **第三轮优化**：针对系统性能和响应速度优化
- **持续优化**：根据用户反馈持续迭代优化

### 9.8 测试工具与环境

#### 9.8.1 测试工具
- **接口测试**：Postman、Apifox
- **性能测试**：JMeter、LoadRunner
- **自动化测试**：Selenium、Cypress（可选）
- **代码质量**：SonarQube、ESLint

#### 9.8.2 测试环境
- **开发环境**：本地开发环境
- **测试环境**：独立测试服务器
- **预发布环境**：预发布服务器
- **生产环境**：正式生产服务器

### 9.9 测试文档

#### 9.9.1 测试计划文档
- 测试范围、测试目标、测试策略、测试资源、测试进度安排

#### 9.9.2 测试用例文档
- 各功能模块的详细测试用例，包括测试步骤、预期结果、实际结果

#### 9.9.3 测试报告文档
- 测试执行情况、问题统计、测试结论、优化建议

#### 9.9.4 Bug跟踪文档
- Bug记录、Bug状态跟踪、Bug修复验证

---

## 十、总结

本开发计划将系统开发分为四个阶段，每个阶段都有明确的目标和详细的实现步骤。开发过程中应严格按照开发规范执行，注重代码质量和系统性能，确保系统能够稳定运行并满足用户需求。

### 10.1 系统架构与技术选型

本系统采用B/S架构设计，前端使用JavaScript、Vue.js等技术构建响应式交互界面，适配PC端与移动端；后端使用Spring Boot框架实现核心业务逻辑开发；数据库使用MySQL存储用户信息、问卷模板、填写数据等结构化数据，搭配ECharts实现数据可视化展示。

### 10.2 功能模块开发与集成

系统按模块化设计思想，划分核心功能模块，包括：
- **用户管理模块**：用户注册、登录、信息管理
- **问卷设计模块**：可视化拖拽编辑、多种题型支持、逻辑跳转、样式个性化设置、模板管理
- **问卷发布与推广模块**：发布设置、多渠道发布（链接、二维码、嵌入代码、社交媒体分享）
- **数据收集模块**：问卷填写界面、数据提交与保存、问卷逻辑校验
- **数据统计模块**：实时统计、基础数据统计、多维度统计算法、数据清洗算法
- **数据分析模块**：交叉分析、趋势分析、样本画像分析
- **数据可视化模块**：多种图表类型、图表自定义配置、图表导出
- **安全管理模块**：访问权限控制、填写限制、数据加密、隐私保护
- **系统管理模块（管理员后台）**：用户管理、问卷管理、数据管理、系统监控

系统开发了问卷逻辑校验、数据清洗、多维度统计等核心算法，完成各模块接口对接与系统集成，确保流程顺畅、数据互通。

### 10.3 系统测试与优化迭代

构建多场景测试用例，开展功能测试、性能测试、兼容性测试、安全性测试。重点测试问卷设计灵活性、数据统计准确性、分析维度完整性、系统响应速度等指标，邀请不同类型用户试用并收集反馈，针对操作便捷性、分析深度、可视化效果等问题进行优化调整。

### 10.4 重要说明

- **参考TDuck**：参考TDuck的设计思路和功能实现方式，但所有代码在现有项目中自主开发
- **技术栈**：使用Vue3 + Element Plus前端技术栈，Spring Boot + MyBatis Plus后端技术栈
- **代码规范**：保持代码的独立性和规范性，严格按照开发规范执行
- **文件存储**：文件存储在后端项目根目录下的upload文件夹
- **管理员后台**：管理员后台为独立的前端页面，与普通用户前端界面分离

### 10.5 开发建议

建议按照阶段逐步推进，每个阶段完成后进行充分测试，确保系统质量。开发过程中应：
1. 严格按照开发规范执行
2. 注重代码质量和系统性能
3. 及时进行功能测试和集成测试
4. 收集用户反馈并持续优化
5. 完善技术文档和接口文档

通过模块化设计、前后端分离架构、完善的测试体系，系统具有良好的可扩展性和可维护性，能够满足在线问卷调查与数据分析的核心需求。

