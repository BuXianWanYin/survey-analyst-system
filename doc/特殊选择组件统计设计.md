# 特殊选择组件统计设计文档

## 一、图片选择（IMAGE_SELECT）统计设计

### 1.1 组件特点
- **支持模式**：单选（single）和多选（multiple）
- **数据结构**：每个选项包含 `value`、`label`、`image`（图片URL）
- **存储格式**：单选存储单个值，多选存储数组

### 1.2 统计设计方案

#### 方案一：增强版表格（推荐）⭐
**展示方式：**
```
┌─────────────────────────────────────────────────┐
│ 选项                │ 小计 │ 比例（条形图）      │
├─────────────────────────────────────────────────┤
│ [图片] 选项1        │  5   │ ████████ 50%       │
│ [图片] 选项2        │  3   │ ██████   30%       │
│ [图片] 选项3        │  2   │ ████     20%       │
└─────────────────────────────────────────────────┘
```

**特点：**
- 在表格的"选项"列显示图片缩略图 + 文字标签
- 支持点击图片放大查看
- 其他统计方式（比例、图表）与普通选择题相同

**实现要点：**
- 修改表格列的渲染，在选项名称前显示图片
- 图片大小：40x40px 或 60x60px
- 使用 Element Plus 的 `el-image` 组件支持预览

#### 方案二：卡片式展示
**展示方式：**
```
┌─────────┐  ┌─────────┐  ┌─────────┐
│ [图片]  │  │ [图片]  │  │ [图片]  │
│ 选项1   │  │ 选项2   │  │ 选项3   │
│ 50% (5) │  │ 30% (3) │  │ 20% (2) │
└─────────┘  └─────────┘  └─────────┘
```

**特点：**
- 每个选项以卡片形式展示
- 图片作为主要视觉元素
- 适合选项较少的场景

### 1.3 实现建议

**前端修改：**
1. 在 `getTableData` 中，对于 IMAGE_SELECT 类型，返回图片URL
2. 在表格渲染时，判断如果是 IMAGE_SELECT，显示图片 + 文字
3. 图表统计保持不变（与普通选择题相同）

**代码示例：**
```javascript
// 在表格中显示图片选择
<el-table-column label="选项" width="250">
  <template #default="{ row }">
    <div v-if="item.type === 'IMAGE_SELECT'" class="image-option-cell">
      <el-image
        :src="row.image"
        fit="cover"
        class="option-image"
        :preview-src-list="[row.image]"
      />
      <span class="option-label">{{ row.optionLabel }}</span>
    </div>
    <span v-else>{{ row.optionLabel }}</span>
  </template>
</el-table-column>
```

---

## 二、级联选择（CASCADER）统计设计

### 2.1 组件特点
- **数据结构**：层级结构，如 `["省", "市", "区"]`
- **存储格式**：数组格式，代表选择的路径
- **选项结构**：树形结构，支持多级嵌套

### 2.2 统计设计方案

#### 方案一：多级表格（推荐）⭐
**展示方式：**
```
┌─────────────────────────────────────────────┐
│ 第一级 │ 第二级 │ 第三级 │ 小计 │ 比例      │
├─────────────────────────────────────────────┤
│ 北京市 │ 海淀区 │ -      │  10  │ ████ 25%  │
│ 北京市 │ 朝阳区 │ -      │  8   │ ███  20%  │
│ 上海市 │ 浦东区 │ 陆家嘴 │  5   │ ██   12.5%│
│ ...                                        │
└─────────────────────────────────────────────┘
```

**特点：**
- 扁平化展示所有路径组合
- 支持按任意级别筛选/分组
- 适合层级较少的场景（2-3级）

#### 方案二：树形表格（推荐）⭐
**展示方式：**
```
┌─────────────────────────────────────────┐
│ 选项                │ 小计 │ 比例       │
├─────────────────────────────────────────┤
│ ▼ 北京市 (18)       │  18  │ █████ 45% │
│   ├─ 海淀区 (10)    │  10  │ ███  25%  │
│   ├─ 朝阳区 (8)     │  8   │ ██   20%  │
│ ▼ 上海市 (22)       │  22  │ ██████ 55%│
│   ├─ 浦东区 (15)    │  15  │ ████ 37.5%│
│   │   ├─ 陆家嘴 (10)│  10  │ ███  25%  │
│   │   └─ 外滩 (5)   │  5   │ █    12.5%│
│   └─ 黄浦区 (7)     │  7   │ ██   17.5%│
└─────────────────────────────────────────┘
```

**特点：**
- 保持层级关系
- 支持展开/折叠
- 每个节点显示该层级的统计
- 适合层级较多的场景

#### 方案三：分组统计
**展示方式：**
```
第一级统计：
┌─────────┬──────┬──────┐
│ 北京市  │  18  │ 45%  │
│ 上海市  │  22  │ 55%  │
└─────────┴──────┴──────┘

第二级统计（北京市）：
┌─────────┬──────┬──────┐
│ 海淀区  │  10  │ 55.6%│
│ 朝阳区  │  8   │ 44.4%│
└─────────┴──────┴──────┘
```

**特点：**
- 按级别分别展示统计
- 支持联动（点击第一级，查看第二级）
- 适合需要逐层分析的场景

### 2.3 实现建议

**后端处理：**
1. 解析级联选择的值（数组格式）
2. 按完整路径统计（扁平化）
3. 同时提供按层级分组的统计

**数据结构：**
```json
{
  "optionStats": [
    {
      "path": ["北京市", "海淀区"],
      "fullPath": "北京市/海淀区",
      "level1": "北京市",
      "level2": "海淀区",
      "count": 10,
      "percentage": 25.0
    }
  ],
  "levelStats": {
    "level1": [
      { "value": "北京市", "count": 18, "percentage": 45.0 }
    ],
    "level2": {
      "北京市": [
        { "value": "海淀区", "count": 10, "percentage": 55.6 }
      ]
    }
  }
}
```

**前端实现：**
- 使用 Element Plus 的 `el-table` 树形表格
- 支持展开/折叠
- 可切换展示模式（扁平化/树形）

---

## 三、推荐实现方案

### 3.1 图片选择（IMAGE_SELECT）
**推荐：方案一（增强版表格）**

**理由：**
- 保持与现有统计表格的一致性
- 图片作为辅助信息，不影响主要统计功能
- 实现简单，用户体验好

**实现步骤：**
1. ✅ 后端已支持（与普通选择题相同处理）
2. ✅ 前端表格增加图片显示（50x50px 缩略图）
3. ✅ 支持图片预览功能（点击图片可放大查看）

### 3.2 级联选择（CASCADER）
**推荐：方案二（树形表格）**

**理由：**
- 保持层级关系的直观性
- 支持逐层查看统计
- 适合大多数使用场景

**实现步骤：**
1. ✅ 后端增加层级统计逻辑（扁平化路径统计）
2. ✅ 前端使用树形表格展示（自动构建树形结构）
3. ✅ 支持展开/折叠（Element Plus 树形表格默认支持）

---

## 四、统计功能对比

| 组件类型 | 统计方式 | 图表支持 | 特殊处理 |
|---------|---------|---------|---------|
| RADIO/CHECKBOX/SELECT | 选项统计 | ✅ 全部图表 | - |
| IMAGE_SELECT | 选项统计 | ✅ 全部图表 | ⭐ 表格中显示图片 |
| CASCADER | 路径统计 | ✅ 饼图/柱状图 | ⭐ 树形表格/层级统计 |

---

## 五、已实现功能 ✅

**已完成：**
- ✅ IMAGE_SELECT：在表格中显示图片缩略图 + 图片预览
- ✅ CASCADER：树形表格展示（自动构建层级结构）
- ✅ SIGN_PAD：签名组件统计（有效签名数 + 签名预览网格）
- ✅ INPUT/TEXTAREA：文本题词云图统计
- ✅ IMAGE/IMAGE_CAROUSEL：展示类组件提示（无需统计）

---

## 六、其他组件统计设计

### 6.1 签名组件（SIGN_PAD）

**统计方式：**
- 有效签名数：统计包含有效签名图片的答案数
- 签名预览网格：展示所有签名的缩略图，支持点击放大查看

**展示效果：**
```
┌─────────────────────────────────────┐
│ 有效签名数: 10  总填写数: 12        │
├─────────────────────────────────────┤
│ 签名预览（10 个签名）                │
│ ┌────┐ ┌────┐ ┌────┐ ┌────┐       │
│ │签名│ │签名│ │签名│ │签名│ ...    │
│ └────┘ └────┘ └────┘ └────┘       │
└─────────────────────────────────────┘
```

### 6.2 展示类组件（IMAGE、IMAGE_CAROUSEL）

**设计决策：**
- **不需要统计**：这些组件仅用于展示内容，用户无法填写，因此无需统计
- **提示信息**：在统计页面显示"该组件为展示类组件，无需统计"的友好提示

### 6.3 文本题（INPUT、TEXTAREA）

**统计方式：**
- 有效答案数：统计非空答案数量
- 词云图：对文本内容进行词频分析，生成词云可视化
- 仅对 INPUT 和 TEXTAREA 类型显示词云图（DATE、TIME、DATETIME、NUMBER 等不显示）

**词云图特点：**
- 过滤停用词（的、了、是等常见无意义词）
- 显示高频词（最多50个）
- 支持自定义颜色方案

