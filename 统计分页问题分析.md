# 统计查询分页问题分析

## 问题概述

前端统计查询**存在分页限制**，但**不是真正的分页机制**，而是固定的数量限制。

## 详细分析

### 1. 后端统计接口

#### `getAllStatistics` 方法（主要统计接口）
- **位置**: `StatisticsServiceImpl.java:468`
- **限制**: 固定分页 `Page<>(1, 10000)`，最多获取10000条数据
- **问题**: 如果数据量超过10000条，统计结果会不准确

```java
com.baomidou.mybatisplus.extension.plugins.pagination.Page<FormData> page = 
    new Page<>(1, 10000);
```

#### `getQuestionStatistics` 方法（单题统计）
- **位置**: `StatisticsServiceImpl.java:134`
- **限制**: 固定分页 `Page<>(1, 10000)`，最多获取10000条数据
- **问题**: 同上，超过10000条数据统计不准确

#### `getFilteredStatistics` 方法（筛选统计）
- **位置**: `StatisticsServiceImpl.java:842`
- **限制**: 固定分页 `Page<>(1, 10000)`，最多获取10000条数据
- **问题**: 同上

### 2. 前端统计接口

#### `loadStatistics` 方法（主要加载方法）
- **位置**: `statistics.vue:1019`
- **调用**: `statisticsApi.getAllStatistics(surveyId.value, {...})`
- **参数**: **没有传递任何分页参数**
- **说明**: 依赖后端的10000条限制

#### `loadStatisticsFallback` 方法（降级方案）
- **位置**: `statistics.vue:1072-1074`
- **限制**: 固定分页 `pageNum: 1, pageSize: 1000`，只获取1000条数据
- **问题**: 如果数据量超过1000条，降级方案的统计会非常不准确

```javascript
const dataRes = await formApi.getFormDataList(formKey.value, {
  pageNum: 1,
  pageSize: 1000  // 只获取1000条
})
```

## 问题影响

### 当前数据量
- **测试数据**: 65条 ✅ 当前无影响
- **限制阈值**: 
  - 降级方案：1000条
  - 主接口：10000条

### 潜在风险
1. **降级方案**：如果统一接口失败，使用降级方案时，超过1000条的数据无法被统计
2. **主接口**：如果数据量超过10000条，部分数据不会被统计，导致统计结果不准确
3. **性能问题**：一次性加载10000条数据可能造成内存和性能压力

## 解决方案建议

### 方案1：移除分页限制（适合数据量不是特别大的场景）
- 后端使用 `selectList` 查询所有数据（无分页限制）
- 优点：统计准确
- 缺点：数据量非常大时可能性能问题

### 方案2：分批查询统计（推荐）
- 后端分批查询数据（如每次5000条），合并统计结果
- 前端保持不变
- 优点：统计准确，性能可控
- 缺点：需要修改后端逻辑

### 方案3：真正的分页统计（适合超大数据量）
- 后端支持分页参数
- 前端可以分页加载统计数据
- 优点：灵活，适合任意数据量
- 缺点：实现复杂，可能影响用户体验

## 当前状态

✅ **65条测试数据**：无影响，远低于限制阈值
⚠️ **超过1000条**：降级方案会不准确
⚠️ **超过10000条**：主接口会不准确

## 建议

1. **短期**：如果预计数据量不会超过10000条，可以保持现状
2. **中期**：建议实现方案2（分批查询统计），确保统计准确性
3. **长期**：根据实际使用情况，考虑是否需要真正的分页统计

